(function(f){f.Jcrop=function(y,A){function h(a){return Math.round(a)+"px"}function E(a){a=f(a).offset();return[a.left,a.top]}function v(a){return[a.pageX-I[0],a.pageY-I[1]]}function F(b){"object"!==typeof b&&(b={});a=f.extend(a,b);f.each(["onChange","onSelect","onRelease","onDblClick"],function(b,s){"function"!==typeof a[s]&&(a[s]=function(){})})}function ca(a,e,s){I=E($img);D.setCursor("move"===a?a:a+"-resize");if("move"===a)return D.activateHandlers(ra(e),X,s);e=u.getFixed();var f=da(a),c=u.getCorner(da(f));
u.setPressed(u.getCorner(f));u.setCurrent(c);D.activateHandlers(sa(a,e),X,s)}function sa(b,e){return function(s){if(a.aspectRatio)switch(b){case "e":s[1]=e.y+1;break;case "w":s[1]=e.y+1;break;case "n":s[0]=e.x+1;break;case "s":s[0]=e.x+1}else switch(b){case "e":s[1]=e.y2;break;case "w":s[1]=e.y2;break;case "n":s[0]=e.x2;break;case "s":s[0]=e.x2}u.setCurrent(s);n.update()}}function ra(a){var e=a;Y.watchKeys();return function(a){u.moveOffset([a[0]-e[0],a[1]-e[1]]);e=a;n.update()}}function da(a){switch(a){case "n":return"sw";
case "s":return"nw";case "e":return"nw";case "w":return"ne";case "ne":return"sw";case "nw":return"se";case "se":return"nw";case "sw":return"ne"}}function fa(b){return function(e){if(a.disabled||"move"===b&&!a.allowMove)return!1;I=E($img);L=!0;ca(b,v(e));e.stopPropagation();e.preventDefault();return!1}}function ga(a,e,s){var f=a.width(),c=a.height();f>e&&0<e&&(f=e,c=e/a.width()*a.height());c>s&&0<s&&(c=s,f=s/a.height()*a.width());w=a.width()/f;x=a.height()/c;a.width(f).height(c)}function Q(a){return{x:a.x*
w,y:a.y*x,x2:a.x2*w,y2:a.y2*x,w:a.w*w,h:a.h*x}}function X(b){b=u.getFixed();b.w>a.minSelect[0]&&b.h>a.minSelect[1]?(n.enableHandles(),n.done()):n.release();D.setCursor(a.allowSelect?"crosshair":"default")}function ha(b){if(a.disabled||!a.allowSelect)return!1;L=!0;I=E($img);n.disableHandles();D.setCursor("crosshair");var e=v(b);u.setPressed(e);n.update();D.activateHandlers(ta,X,"touch"===b.type.substring(0,5));Y.watchKeys();b.stopPropagation();b.preventDefault();return!1}function ta(a){u.setCurrent(a);
n.update()}function ia(){var b=f("<div></div>").addClass(a.baseClass+"-tracker");ja&&b.css({opacity:0,backgroundColor:"white"});return b}function ka(b){la([b[0]/w,b[1]/x,b[2]/w,b[3]/x]);a.onSelect.call(B,Q(u.getFixed()));n.enableHandles()}function la(a){u.setPressed([a[0],a[1]]);u.setCurrent([a[2],a[3]]);n.update()}function ma(){a.disabled=!0;n.disableHandles();n.setCursor("default");D.setCursor("default")}function na(){a.disabled=!1;Z()}function $(b,e,s){e=e||a.bgColor;a.bgFade&&f.fx.step.hasOwnProperty("backgroundColor")&&
a.fadeTime&&!s?b.animate({backgroundColor:e},{queue:!1,duration:a.fadeTime}):b.css("backgroundColor",e)}function Z(b){a.allowResize?b?n.enableOnly():n.enableHandles():n.disableHandles();D.setCursor(a.allowSelect?"crosshair":"default");n.setCursor(a.allowMove?"move":"default");a.hasOwnProperty("trueSize")&&(w=a.trueSize[0]/r,x=a.trueSize[1]/l);a.hasOwnProperty("setSelect")&&(ka(a.setSelect),n.done(),delete a.setSelect);J.refresh();a.bgColor!=oa&&($(a.shade?J.getShades():G,a.shade?a.shadeColor||a.bgColor:
a.bgColor),oa=a.bgColor);R!=a.bgOpacity&&(R=a.bgOpacity,a.shade?J.refresh():n.setBgOpacity(R));S=a.maxSize[0]||0;T=a.maxSize[1]||0;U=a.minSize[0]||0;V=a.minSize[1]||0;a.hasOwnProperty("outerImage")&&($img.attr("src",a.outerImage),delete a.outerImage);n.refresh()}var a=f.extend({},f.Jcrop.defaults),I,M=navigator.userAgent.toLowerCase(),ja=/msie/.test(M),pa=/msie [1-6]\./.test(M);"object"!==typeof y&&(y=f(y)[0]);"object"!==typeof A&&(A={});F(A);var M={border:"none",visibility:"visible",margin:0,padding:0,
position:"absolute",top:0,left:0},t=f(y),qa=!0;if("IMG"==y.tagName){if(0!==t[0].width&&0!==t[0].height)t.width(t[0].width),t.height(t[0].height);else{var aa=new Image;aa.src=t[0].src;t.width(aa.width);t.height(aa.height)}$img=t.clone().removeAttr("id").css(M).show();$img.width(t.width());$img.height(t.height());t.after($img).hide()}else $img=t.css(M).show(),qa=!1,null===a.shade&&(a.shade=!0);ga($img,a.boxWidth,a.boxHeight);var r=$img.width(),l=$img.height(),G=f("<div />").width(r).height(l).addClass(a.baseClass+
"-holder").css({position:"relative",backgroundColor:a.bgColor,overflow:"hidden"}).insertAfter(t).append($img);a.addClass&&G.addClass(a.addClass);var H=f("<div />"),W=f("<div />").width("100%").height("100%").css({zIndex:310,position:"absolute",overflow:"hidden"}),N=f("<div />").width("100%").height("100%").css("zIndex",320),O=f("<div />").css({position:"absolute",zIndex:600}).dblclick(function(){var b=u.getFixed();a.onDblClick.call(B,b)}).insertBefore($img).append(W,N);qa&&(H=f("<img />").attr("src",
$img.attr("src")).css(M).width(r).height(l),W.append(H));pa&&O.css({overflowY:"hidden"});var P=a.boundary,K=ia().width(r+2*P).height(l+2*P).css({position:"absolute",top:h(-P),left:h(-P),zIndex:290}).mousedown(ha),oa=a.bgColor,R=a.bgOpacity,S,T,U,V,w,x,L,ba,ua;I=E($img);var C=function(){function b(){var a={},b=["touchstart","touchmove","touchend"],c=document.createElement("div"),d;try{for(d=0;d<b.length;d++){var e=b[d],e="on"+e,k=e in c;k||(c.setAttribute(e,"return;"),k="function"==typeof c[e]);a[b[d]]=
k}return a.touchstart&&a.touchend&&a.touchmove}catch(f){return!1}}var e;e=!0===a.touchSupport||!1===a.touchSupport?a.touchSupport:b();return{createDragger:function(b){return function(e){if(a.disabled||"move"===b&&!a.allowMove)return!1;I=E($img);L=!0;ca(b,v(C.cfilter(e)),!0);e.stopPropagation();e.preventDefault();return!1}},newSelection:function(a){return ha(C.cfilter(a))},cfilter:function(a){a.pageX=a.originalEvent.changedTouches[0].pageX;a.pageY=a.originalEvent.changedTouches[0].pageY;return a},
isSupported:b,support:e}}(),u=function(){function b(){if(!a.aspectRatio){var p=m-c,b=k-d;S&&Math.abs(p)>S&&(m=0<p?c+S:c-S);T&&Math.abs(b)>T&&(k=0<b?d+T:d-T);V/x&&Math.abs(b)<V/x&&(k=0<b?d+V/x:d-V/x);U/w&&Math.abs(p)<U/w&&(m=0<p?c+U/w:c-U/w);0>c&&(m-=c,c-=c);0>d&&(k-=d,d-=d);0>m&&(c-=m,m-=m);0>k&&(d-=k,k-=k);m>r&&(p=m-r,c-=p,m-=p);k>l&&(p=k-l,d-=p,k-=p);c>r&&(p=c-l,k-=p,d-=p);d>l&&(p=d-l,k-=p,d-=p);return n(f(c,d,m,k))}var p=a.aspectRatio,b=a.minSize[0]/w,e=a.maxSize[0]/w,h=m-c,z=k-d,q=Math.abs(h),
g=Math.abs(z);0===e&&(e=10*r);q/g<p?(q=k,g*=p,g=0>h?c-g:g+c,0>g?(g=0,q=Math.abs((g-c)/p),q=0>z?d-q:q+d):g>r&&(g=r,q=Math.abs((g-c)/p),q=0>z?d-q:q+d)):(g=m,q/=p,q=0>z?d-q:d+q,0>q?(q=0,g=Math.abs((q-d)*p),g=0>h?c-g:g+c):q>l&&(q=l,g=Math.abs(q-d)*p,g=0>h?c-g:g+c));g>c?(g-c<b?g=c+b:g-c>e&&(g=c+e),q=q>d?d+(g-c)/p:d-(g-c)/p):g<c&&(c-g<b?g=c-b:c-g>e&&(g=c-e),q=q>d?d+(c-g)/p:d-(c-g)/p);0>g?(c-=g,g=0):g>r&&(c-=g-r,g=r);0>q?(d-=q,q=0):q>l&&(d-=q-l,q=l);return n(f(c,d,g,q))}function e(a){0>a[0]&&(a[0]=0);0>
a[1]&&(a[1]=0);a[0]>r&&(a[0]=r);a[1]>l&&(a[1]=l);return[Math.round(a[0]),Math.round(a[1])]}function f(a,b,c,d){var e=a,k=c,g=b,m=d;c<a&&(e=c,k=a);d<b&&(g=d,m=b);return[e,g,k,m]}function n(a){return{x:a[0],y:a[1],x2:a[2],y2:a[3],w:a[2]-a[0],h:a[3]-a[1]}}var c=0,d=0,m=0,k=0,z,h;return{flipCoords:f,setPressed:function(a){a=e(a);m=c=a[0];k=d=a[1]},setCurrent:function(a){a=e(a);z=a[0]-m;h=a[1]-k;m=a[0];k=a[1]},getOffset:function(){return[z,h]},moveOffset:function(a){var b=a[0];a=a[1];0>c+b&&(b-=b+c);0>
d+a&&(a-=a+d);l<k+a&&(a+=l-(k+a));r<m+b&&(b+=r-(m+b));c+=b;m+=b;d+=a;k+=a},getCorner:function(a){var c=b();switch(a){case "ne":return[c.x2,c.y];case "nw":return[c.x,c.y];case "se":return[c.x2,c.y2];case "sw":return[c.x,c.y2]}},getFixed:b}}(),J=function(){function b(){return e(u.getFixed())}function e(a){p.top.css({left:h(a.x),width:h(a.w),height:h(a.y)});p.bottom.css({top:h(a.y2),left:h(a.x),width:h(a.w),height:h(l-a.y2)});p.right.css({left:h(a.x2),width:h(r-a.x2)});p.left.css({width:h(a.x)})}function s(){return f("<div />").css({position:"absolute",
backgroundColor:a.shadeColor||a.bgColor}).appendTo(t)}function ea(){z||(z=!0,t.insertBefore($img),b(),n.setBgOpacity(1,0,1),H.hide(),c(a.shadeColor||a.bgColor,1),n.isAwake()?m(a.bgOpacity,1):m(1,1))}function c(a,b){$(k(),a,b)}function d(){z&&(t.remove(),H.show(),z=!1,n.isAwake()?n.setBgOpacity(a.bgOpacity,1,1):(n.setBgOpacity(1,1,1),n.disableHandles()),$(G,0,1))}function m(b,c){z&&(a.bgFade&&!c?t.animate({opacity:1-b},{queue:!1,duration:a.fadeTime}):t.css({opacity:1-b}))}function k(){return t.children()}
var z=!1,t=f("<div />").css({position:"absolute",zIndex:240,opacity:0}),p={top:s(),left:s().height(l),right:s().height(l),bottom:s()};return{update:b,updateRaw:e,getShades:k,setBgColor:c,enable:ea,disable:d,resize:function(a,b){p.left.css({height:h(b)});p.right.css({height:h(b)})},refresh:function(){a.shade?ea():d();n.isAwake()&&m(a.bgOpacity)},opacity:m}}(),n=function(){function b(a,b){var c=f("<div />").mousedown(fa(a)).css({cursor:a+"-resize",position:"absolute",zIndex:b}).addClass("ord-"+a);C.support&&
c.bind("touchstart.jcrop",C.createDragger(a));N.append(c);return c}function e(a){var c;for(c=0;c<a.length;c++)b(a[c],t++).addClass("jcrop-dragbar")}function s(b){var c,d;for(d=0;d<b.length;d++){switch(b[d]){case "n":c="hline";break;case "s":c="hline bottom";break;case "e":c="vline right";break;case "w":c="vline"}var e=w,k=b[d],g=c,g=f("<div />").css({position:"absolute",opacity:a.borderOpacity}).addClass(a.baseClass+"-"+g);W.append(g);e[k]=g}}function n(c){var d;for(d=0;d<c.length;d++){var e=x,k=
c[d],f=a.handleSize,g=b(c[d],t++).css({opacity:a.handleOpacity}).addClass(a.baseClass+"-handle");f&&g.width(f).height(f);e[k]=g}}function c(){var a=u.getFixed();u.setPressed([a.x,a.y]);u.setCurrent([a.x2,a.y2]);d()}function d(a){if(r)return m(a)}function m(c){var b=u.getFixed(),d=b.h;O.width(Math.round(b.w)).height(Math.round(d));var d=b.x,e=b.y;a.shade||H.css({top:h(-e),left:h(-d)});O.css({top:h(e),left:h(d)});a.shade&&J.updateRaw(b);r||(O.show(),a.shade?J.opacity(R):k(R,!0),r=!0);c?a.onSelect.call(B,
Q(b)):a.onChange.call(B,Q(b))}function k(b,c,d){if(r||c)a.bgFade&&!d?$img.animate({opacity:b},{queue:!1,duration:a.fadeTime}):$img.css("opacity",b)}function z(){q=!0;if(a.allowResize)return N.show(),!0}function l(){q=!1;N.hide()}function p(a){a?(ba=!0,l()):(ba=!1,z())}var r,t=370,w={},x={},q=!1;a.dragEdges&&f.isArray(a.createDragbars)&&e(a.createDragbars);f.isArray(a.createHandles)&&n(a.createHandles);a.drawBorders&&f.isArray(a.createBorders)&&s(a.createBorders);f(document).bind("touchstart.jcrop-ios",
function(a){f(a.currentTarget).hasClass("jcrop-tracker")&&a.stopPropagation()});var g=ia().mousedown(fa("move")).css({cursor:"move",position:"absolute",zIndex:360});C.support&&g.bind("touchstart.jcrop",C.createDragger("move"));W.append(g);l();return{updateVisible:d,update:m,release:function(){l();O.hide();a.shade?J.opacity(1):k(1);r=!1;a.onRelease.call(B)},refresh:c,isAwake:function(){return r},setCursor:function(a){g.css("cursor",a)},enableHandles:z,enableOnly:function(){q=!0},showHandles:function(){q&&
N.show()},disableHandles:l,animMode:p,setBgOpacity:k,done:function(){p(!1);c()}}}(),D=function(){function b(a){c(v(a));return!1}function e(b){b.preventDefault();b.stopPropagation();L&&(L=!1,d(v(b)),n.isAwake()&&a.onSelect.call(B,Q(u.getFixed())),K.css({zIndex:290}),f(document).unbind(".jcrop"),c=function(){},d=function(){});return!1}function s(a){c(v(C.cfilter(a)));return!1}function h(a){return e(C.cfilter(a))}var c=function(){},d=function(){},m=a.trackDocument;m||K.mousemove(b).mouseup(e).mouseout(e);
$img.before(K);return{activateHandlers:function(a,n,l){L=!0;c=a;d=n;K.css({zIndex:450});l?f(document).bind("touchmove.jcrop",s).bind("touchend.jcrop",h):m&&f(document).bind("mousemove.jcrop",b).bind("mouseup.jcrop",e);return!1},setCursor:function(a){K.css("cursor",a)}}}(),Y=function(){function b(a){h.hide()}function e(b,c,e){a.allowMove&&(u.moveOffset([c,e]),n.updateVisible(!0));b.preventDefault();b.stopPropagation()}function s(b){if(b.ctrlKey||b.metaKey)return!0;var c=(ua=b.shiftKey?!0:!1)?10:1;
switch(b.keyCode){case 37:e(b,-c,0);break;case 39:e(b,c,0);break;case 38:e(b,0,-c);break;case 40:e(b,0,c);break;case 27:a.allowSelect&&n.release();break;case 9:return!0}return!1}var h=f('<input type="radio" />').css({position:"fixed",left:"-120px",width:"12px"}).addClass("jcrop-keymgr"),c=f("<div />").css({position:"absolute",overflow:"hidden"}).append(h);a.keySupport&&(h.keydown(s).blur(b),pa||!a.fixedSupport?(h.css({position:"absolute",left:"-20px"}),c.append(h).insertBefore($img)):h.insertBefore($img));
return{watchKeys:function(){a.keySupport&&(h.show(),h.focus())}}}();C.support&&K.bind("touchstart.jcrop",C.newSelection);N.hide();Z(!0);var B={setImage:function(b,e){n.release();ma();var f=new Image;f.onload=function(){var h=f.height,c=a.boxWidth,d=a.boxHeight;$img.width(f.width).height(h);$img.attr("src",b);H.attr("src",b);ga($img,c,d);r=$img.width();l=$img.height();H.width(r).height(l);K.width(r+2*P).height(l+2*P);G.width(r).height(l);J.resize(r,l);na();"function"===typeof e&&e.call(B)};f.src=b},
animateTo:function(b,e){var f=b[0]/w,h=b[1]/x,c=b[2]/w,d=b[3]/x;if(!ba){var m=u.flipCoords(f,h,c,d),k=u.getFixed(),l=[k.x,k.y,k.x2,k.y2],r=a.animationDelay,p=m[0]-l[0],t=m[1]-l[1],y=m[2]-l[2],A=m[3]-l[3],v=0,q=a.swingSpeed,f=l[0],h=l[1],c=l[2],d=l[3];n.animMode(!0);var g=function(){return function(){v+=(100-v)/q;l[0]=Math.round(f+v/100*p);l[1]=Math.round(h+v/100*t);l[2]=Math.round(c+v/100*y);l[3]=Math.round(d+v/100*A);99.8<=v&&(v=100);100>v?(la(l),window.setTimeout(g,r)):(n.done(),n.animMode(!1),
"function"===typeof e&&e.call(B))}}();window.setTimeout(g,r)}},setSelect:ka,setOptions:function(a){F(a);Z()},tellSelect:function(){return Q(u.getFixed())},tellScaled:function(){return u.getFixed()},setClass:function(b){G.removeClass().addClass(a.baseClass+"-holder").addClass(b)},rotate:function(a){kcRotate($img[0],a);kcRotate(H[0],a)},disable:ma,enable:na,cancel:function(){n.done();D.activateHandlers(null,null)},release:n.release,destroy:function(){G.remove();t.show();t.css("visibility","visible");
f(y).removeData("Jcrop")},focus:Y.watchKeys,getBounds:function(){return[r*w,l*x]},getWidgetSize:function(){return[r,l]},getScaleFactor:function(){return[w,x]},getOptions:function(){return a},ui:{holder:G,selection:O}};ja&&G.bind("selectstart",function(){return!1});t.data("Jcrop",B);return B};f.fn.Jcrop=function(y,A){var h;this.each(function(){if(f(this).data("Jcrop")){if("api"===y)return f(this).data("Jcrop");f(this).data("Jcrop").setOptions(y)}else"IMG"==this.tagName?f.Jcrop.Loader(this,function(){f(this).css({display:"block",
visibility:"hidden"});h=f.Jcrop(this,y);f.isFunction(A)&&A.call(h)}):(f(this).css({display:"block",visibility:"hidden"}),h=f.Jcrop(this,y),f.isFunction(A)&&A.call(h))});return this};f.Jcrop.Loader=function(y,A,h){function E(){F.complete?(v.unbind(".jcloader"),f.isFunction(A)&&A.call(F)):window.setTimeout(E,50)}var v=f(y),F=v[0];v.bind("load.jcloader",E).bind("error.jcloader",function(y){v.unbind(".jcloader");f.isFunction(h)&&h.call(F)});F.complete&&f.isFunction(A)&&(v.unbind(".jcloader"),A.call(F))};
f.Jcrop.defaults={allowSelect:!0,allowMove:!0,allowResize:!0,trackDocument:!0,baseClass:"jcrop",addClass:null,bgColor:"black",bgOpacity:.6,bgFade:!1,borderOpacity:.4,handleOpacity:.5,handleSize:null,aspectRatio:0,keySupport:!0,createHandles:"n s e w nw ne se sw".split(" "),createDragbars:["n","s","e","w"],createBorders:["n","s","e","w"],drawBorders:!0,dragEdges:!0,fixedSupport:!0,touchSupport:null,shade:null,boxWidth:0,boxHeight:0,boundary:2,fadeTime:400,animationDelay:20,swingSpeed:3,minSelect:[0,
0],maxSize:[0,0],minSize:[0,0],onChange:function(){},onSelect:function(){},onDblClick:function(){},onRelease:function(){}}})(jQuery);