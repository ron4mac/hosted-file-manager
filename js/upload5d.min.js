(function(l){function y(a,b,c){a.innerHTML+=b;c&&(a.className="failure",z++)}function r(a){a.stopPropagation();a.preventDefault();a.target.className="dragover"==a.type?"hover":""}function s(a){A=m.offsetWidth;a instanceof FileList||(r(a),a=a.target.files||a.dataTransfer.files);for(var b=0,c;c=a[b];b++)t+=c.size,d.push(c),n.innerHTML=d.length,p(!1,"fsel");d.length&&(e.style.display=u)}function B(){f||(allDone=1,typeof("function"==fup_done)&&fup_done(z))}function p(a,b){a&&(--g||B());!f&&d.length&&
(!v||g<v)&&(new C(d.shift()),g++,n.innerHTML=d.length);0>=d.length&&(e.style.display=h,k.style.display=h)}function w(a){m&&(x+=a,m.style.backgroundPosition=Math.floor(A*x/t)-800+"px 0")}function C(a){var b=this,c=null;this.lastsz=0;this.fsize=a.size;this.doAbort=function(){this.xhr?this.xhr.abort():q.removeChild(this.progress)};this.xhr=new XMLHttpRequest;if(this.xhr.upload)if(this.xhr.upload.onabort=function(a){w(b.fsize-b.lastsz)},this.xhr.upload.onloadstart=function(c){this.onprogress=function(c){c.lengthComputable&&
(b.progress.style.backgroundPosition=Math.floor(b.progressW*c.loaded/c.total)-800+"px -20px",c.loaded==c.total&&(b.progress.innerHTML=a.name,b.progress.className="indeterm",b.progress.style.backgroundPosition=""),w(c.loaded-b.lastsz),b.lastsz=c.loaded)}},"object"==typeof fup_ftypes&&0>fup_ftypes.indexOf(a.type)?c="Cannot upload a file of this type. ("+a.type+")":a.size>document.getElementById("MAX_FILE_SIZE").value&&(c="File is larger than max size allowed."),this.progress=q.appendChild(document.createElement("p")),
this.progress.appendChild(document.createTextNode(a.name)),this.progress.innerHTML=this.progress.innerHTML+'<img src="'+fmx_appPath+'css/redX.png" class="abortX" onclick="AbortUpload(this);" />',this.progressW=this.progress.offsetWidth,this.progress._upld=this,c)y(this.progress,"<br />"+c,!0),w(a.size),p(!0,"errM");else if(this.xhr.onreadystatechange=function(a){a="";4==b.xhr.readyState&&(200==b.xhr.status?(a=b.xhr.responseText,a="Ok"==a?"":"<br />"+(a?a:"Could not upload")):a=0===b.xhr.status?a+
"<br />-- aborted":a+("<br />"+b.xhr.status+": "+b.xhr.statusText),a?y(b.progress,a,!0):q.removeChild(b.progress),p(!0,"rst"))},this.xhr.open("POST",fmx_appPath+"upload5.php",!0),fup_payload){c=new FormData;c.append("user_file[]",a);for(var d in fup_payload)c.append(d,fup_payload[d]);this.xhr.send(c)}else this.xhr.setRequestHeader("Content-Type","application/octet-stream"),this.xhr.setRequestHeader("X_FILENAME",a.name),this.xhr.send(a)}function D(){var a=document.getElementById("upload_field"),b=
document.getElementById("dropArea"),c=document.getElementById("submitbutton");n=document.getElementById("qCount");e=document.getElementById("qstop");k=document.getElementById("qgocan");a&&a.addEventListener("change",s,!1);(new XMLHttpRequest).upload&&(b.addEventListener("dragover",r,!1),b.addEventListener("dragleave",r,!1),b.addEventListener("drop",s,!1),b.style.display="block",c&&(c.style.display="none"),m=document.getElementById("totprogress"),q=document.getElementById("fprogress"))}var m,A,q,n,
d=[],v=3,f=!1,g=0,t=0,x=0,z=0,e,k,h="none",u="inline-block";window.File&&window.FileList&&D();l.fupQctrl={stop:function(){f=!0;e.style.display=h;k.style.display=u},go:function(){f=!1;e.style.display=u;for(k.style.display=h;d.length&&g<v;)p(!1,"go")},cancel:function(){d.length=0;f=!1;k.style.display=h;n.innerHTML=0;g||B()}};l.fupQadd2=s})(window);function AbortUpload(l){l.parentNode._upld.doAbort()};