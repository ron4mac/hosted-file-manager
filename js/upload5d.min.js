(function(m,e){function z(a,b,c){a.innerHTML+=b;c&&(a.className="failure",A++)}function s(a){a.stopPropagation();a.preventDefault();a.target.className="dragover"==a.type?"hover":""}function t(a){B=n.offsetWidth;a instanceof FileList||(s(a),a=a.target.files||a.dataTransfer.files);for(var b=0,c;c=a[b];b++)u+=c.size,d.push(c),p.innerHTML=d.length,q(!1,"fsel");d.length&&(f.style.display=v)}function C(){g||(allDone=1,typeof("function"==e.done)&&e.done(A))}function q(a,b){a&&(--h||C());!g&&d.length&&(!w||
h<w)&&(new D(d.shift()),h++,p.innerHTML=d.length);0>=d.length&&(f.style.display=k,l.style.display=k)}function x(a){n&&(y+=a,n.style.backgroundPosition=Math.floor(B*y/u)+"px 0")}function D(a){var b=this,c=null;this.lastsz=0;this.fsize=a.size;this.doAbort=function(){this.xhr?this.xhr.abort():r.removeChild(this.progress)};this.xhr=new XMLHttpRequest;if(this.xhr.upload)if(this.xhr.upload.onabort=function(a){x(b.fsize-b.lastsz)},this.xhr.upload.onloadstart=function(c){this.onprogress=function(c){c.lengthComputable&&
(b.progress.style.backgroundPosition=Math.floor(b.progressW*c.loaded/c.total)+"px 0",c.loaded==c.total&&(b.progress.innerHTML=a.name,b.progress.className="indeterm",b.progress.style.backgroundPosition=""),x(c.loaded-b.lastsz),b.lastsz=c.loaded)}},"object"==typeof e.ftypes&&0>e.ftypes.indexOf(a.type)?c=e.lang.notype+" ("+a.type+")":a.size>document.getElementById("MAX_FILE_SIZE").value&&(c=e.lang.toobig),this.progress=r.appendChild(document.createElement("p")),this.progress.appendChild(document.createTextNode(a.name)),
this.progress.innerHTML=this.progress.innerHTML+'<img src="'+fmx_appPath+'css/redX.png" class="abortX" onclick="AbortUpload(this);" />',this.progressW=this.progress.offsetWidth,this.progress._upld=this,c)z(this.progress,"<br />"+c,!0),x(a.size),q(!0,"errM");else if(this.xhr.onreadystatechange=function(a){a="";4==b.xhr.readyState&&(200==b.xhr.status?(a=b.xhr.responseText,a="Ok"==a?"":"<br />"+(a?a:e.lang.noupld)):a=0===b.xhr.status?a+("<br />"+e.lang.abortd):a+("<br />"+b.xhr.status+": "+b.xhr.statusText),
a?z(b.progress,a,!0):r.removeChild(b.progress),q(!0,"rst"))},this.xhr.open("POST",fmx_appPath+"upload5.php",!0),e.payload){c=new FormData;c.append("user_file[]",a);for(var d in e.payload)c.append(d,e.payload[d]);this.xhr.send(c)}else this.xhr.setRequestHeader("Content-Type","application/octet-stream"),this.xhr.setRequestHeader("X_FILENAME",a.name),this.xhr.send(a)}function E(){var a=document.getElementById("upload_field"),b=document.getElementById("dropArea"),c=document.getElementById("submitbutton");
p=document.getElementById("qCount");f=document.getElementById("qstop");l=document.getElementById("qgocan");a&&a.addEventListener("change",t,!1);(new XMLHttpRequest).upload&&(b.addEventListener("dragover",s,!1),b.addEventListener("dragleave",s,!1),b.addEventListener("drop",t,!1),b.style.display="block",c&&(c.style.display="none"),n=document.getElementById("totprogress"),r=document.getElementById("fprogress"))}var n,B,r,p,d=[],w=3,g=!1,h=0,u=0,y=0,A=0,f,l,k="none",v="inline-block";window.File&&window.FileList&&
E();m.fupQctrl={stop:function(){g=!0;f.style.display=k;l.style.display=v},go:function(){g=!1;f.style.display=v;for(l.style.display=k;d.length&&h<w;)q(!1,"go")},cancel:function(){d.length=0;g=!1;l.style.display=k;p.innerHTML=0;h||C()}};m.fupQadd2=t})(window,h5_fup);function AbortUpload(m){m.parentNode._upld.doAbort()};