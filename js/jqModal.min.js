(function(f){f.fn.jqm=function(n){var p=f.extend({},f.jqm.params,n);return this.each(function(){var q=f(this),o=f(this).data("jqm");if(!o){o={ID:j++}}q.data("jqm",f.extend(p,o)).addClass("jqm-init");p.trigger&&f(this).jqmAddTrigger(p.trigger)})};f.fn.jqmAddTrigger=function(n){return this.each(function(){if(!a(f(this),"jqmShow",n)){d("jqmAddTrigger must be called on initialized modals")}})};f.fn.jqmAddClose=function(n){return this.each(function(){if(!a(f(this),"jqmHide",n)){d("jqmAddClose must be called on initialized modals")}})};f.fn.jqmShow=function(n){return this.each(function(){!this._jqmShown&&k(f(this),n)})};f.fn.jqmHide=function(n){return this.each(function(){this._jqmShown&&h(f(this),n)})};var d=function(n){if(window.console&&window.console.error){window.console.error(n)}},k=function(u,q){var x=u.data("jqm"),q=q||window.event,w=(parseInt(u.css("z-index"),10)),w=(w>0)?w:3000,n=f("<div></div>").addClass(x.overlayClass).css({height:"100%",width:"100%",position:"fixed",left:0,top:0,"z-index":w-1}),r={w:u,c:x,o:n,t:q};u.css("z-index",w);if(x.ajax){var s=x.target||u,p=x.ajax;s=(typeof s=="string")?f(s,u):f(s);if(p.substr(0,1)=="@"){p=f(q).attr(p.substring(1))}s.html(x.ajaxText);g(r);s.load(p,function(){x.onLoad&&x.onLoad.call(this,r)})}else{g(r)}},h=function(q,n){var r=q.data("jqm"),n=n||window.event,p={w:q,c:r,o:q.data("jqmv"),t:n};m(p)},i=function(n){if(n.c.overlay>0){n.o.prependTo("body");n.o.focus();n.o.css("opacity",n.c.overlay/100)}n.w.show();f.jqm.focusFunc(n.w);return true},e=function(n){n.w.hide()&&n.o&&n.o.remove();return true},a=function(p,o,n){if(!p.data("jqm")){return false}return f(n).each(function(){this[o]=this[o]||[];this[o].push(p)}).click(function(){var q=this;f.each(this[o],function(r,s){s[o](q)});return false})},g=function(p){var q=p.w,n=p.o,r=p.c;if(r.onShow(p)!==false){q[0]._jqmShown=true;if(r.modal){!b[0]&&l("bind");b.push(q)}else{q.jqmAddClose(n)}r.closeClass&&q.jqmAddClose(f("."+r.closeClass,q));r.toTop&&n&&q.before('<span id="jqmP'+r.ID+'"></span>').insertAfter(n);q.data("jqmv",n)}},m=function(p){var q=p.w,n=p.o,r=p.c;if(r.onHide(p)!==false){q[0]._jqmShown=false;if(r.modal){b.pop();!b[0]&&l("unbind")}r.toTop&&n&&f("#jqmP"+r.ID).after(q).remove()}},l=function(n){f(document)[n]("keypress keydown mousedown",c)},c=function(p){var o=f(p.target).data("jqm")||f(p.target).parents(".jqm-init:first").data("jqm"),n=b[b.length-1].data("jqm");if(o&&o.ID==n.ID){return true}return f.jqm.focusFunc(n)},j=0,b=[];f.jqm={params:{overlay:50,overlayClass:"jqmOverlay",closeClass:"jqmClose",trigger:".jqModal",ajax:false,target:false,ajaxText:"",modal:false,toTop:false,onShow:i,onHide:e,onLoad:false},focusFunc:function(n){f("input:text:visible:first",n).focus();return false}}})(jQuery);