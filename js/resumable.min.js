(function(){var h=function(l){function m(b,d){var a=this;a.opts={};a.getOpt=b.getOpt;a._prevProgress=0;a.resumableObj=b;a.file=d;a.fileName=d.fileName||d.name;a.size=d.size;a.relativePath=d.webkitRelativePath||a.fileName;a.uniqueIdentifier=f.generateUniqueIdentifier(d);a._pause=!1;a.container="";var e=!1,c=function(c,b){switch(c){case "progress":a.resumableObj.fire("fileProgress",a);break;case "error":a.abort();e=!0;a.chunks=[];a.resumableObj.fire("fileError",a,b);break;case "success":if(e)break;
a.resumableObj.fire("fileProgress",a);a.isComplete()&&a.resumableObj.fire("fileSuccess",a,b);break;case "retry":a.resumableObj.fire("fileRetry",a)}};a.chunks=[];a.abort=function(){var c=0;f.each(a.chunks,function(a){"uploading"==a.status()&&(a.abort(),c++)});0<c&&a.resumableObj.fire("fileProgress",a)};a.cancel=function(){var c=a.chunks;a.chunks=[];f.each(c,function(c){"uploading"==c.status()&&(c.abort(),a.resumableObj.uploadNextChunk())});a.resumableObj.removeFile(a);a.resumableObj.fire("fileProgress",
a)};a.retry=function(){a.bootstrap();var c=!1;a.resumableObj.on("chunkingComplete",function(){c||a.resumableObj.upload();c=!0})};a.bootstrap=function(){a.abort();e=!1;a.chunks=[];a._prevProgress=0;for(var b=a.getOpt("forceChunkSize")?Math.ceil:Math.floor,d=Math.max(b(a.file.size/a.getOpt("chunkSize")),1),b=0;b<d;b++)(function(b){window.setTimeout(function(){a.chunks.push(new n(a.resumableObj,a,b,c));a.resumableObj.fire("chunkingProgress",a,b/d)},0)})(b);window.setTimeout(function(){a.resumableObj.fire("chunkingComplete",
a)},0)};a.progress=function(){if(e)return 1;var c=0,b=!1;f.each(a.chunks,function(a){"error"==a.status()&&(b=!0);c+=a.progress(!0)});c=b?1:.999<c?1:c;c=Math.max(a._prevProgress,c);return a._prevProgress=c};a.isUploading=function(){var c=!1;f.each(a.chunks,function(b){if("uploading"==b.status())return c=!0,!1});return c};a.isComplete=function(){var c=!1;f.each(a.chunks,function(b){var a=b.status();if("pending"==a||"uploading"==a||1===b.preprocessState)return c=!0,!1});return!c};a.pause=function(c){a._pause=
"undefined"===typeof c?a._pause?!1:!0:c};a.isPaused=function(){return a._pause};a.resumableObj.fire("chunkingStart",a);a.bootstrap();return this}function n(b,d,a,e){var c=this;c.opts={};c.getOpt=b.getOpt;c.resumableObj=b;c.fileObj=d;c.fileObjSize=d.size;c.fileObjType=d.file.type;c.offset=a;c.callback=e;c.lastProgressCallback=new Date;c.tested=!1;c.retries=0;c.pendingRetry=!1;c.preprocessState=0;b=c.getOpt("chunkSize");c.loaded=0;c.startByte=c.offset*b;c.endByte=Math.min(c.fileObjSize,(c.offset+1)*
b);c.fileObjSize-c.endByte<b&&!c.getOpt("forceChunkSize")&&(c.endByte=c.fileObjSize);c.xhr=null;c.test=function(){c.xhr=new XMLHttpRequest;var b=function(a){c.tested=!0;a=c.status();"success"==a?(c.callback(a,c.message()),c.resumableObj.uploadNextChunk()):c.send()};c.xhr.addEventListener("load",b,!1);c.xhr.addEventListener("error",b,!1);var a=[],b=c.getOpt("query");"function"==typeof b&&(b=b(c.fileObj,c));f.each(b,function(c,b){a.push([encodeURIComponent(c),encodeURIComponent(b)].join("="))});a.push(["resumableChunkNumber",
encodeURIComponent(c.offset+1)].join("="));a.push(["resumableChunkSize",encodeURIComponent(c.getOpt("chunkSize"))].join("="));a.push(["resumableCurrentChunkSize",encodeURIComponent(c.endByte-c.startByte)].join("="));a.push(["resumableTotalSize",encodeURIComponent(c.fileObjSize)].join("="));a.push(["resumableType",encodeURIComponent(c.fileObjType)].join("="));a.push(["resumableIdentifier",encodeURIComponent(c.fileObj.uniqueIdentifier)].join("="));a.push(["resumableFilename",encodeURIComponent(c.fileObj.fileName)].join("="));
a.push(["resumableRelativePath",encodeURIComponent(c.fileObj.relativePath)].join("="));a.push(["resumableTotalChunks",encodeURIComponent(c.fileObj.chunks.length)].join("="));c.xhr.open("GET",f.getTarget(a));c.xhr.timeout=c.getOpt("xhrTimeout");c.xhr.withCredentials=c.getOpt("withCredentials");f.each(c.getOpt("headers"),function(a,b){c.xhr.setRequestHeader(a,b)});c.xhr.send(null)};c.preprocessFinished=function(){c.preprocessState=2;c.send()};c.send=function(){var a=c.getOpt("preprocess");if("function"===
typeof a)switch(c.preprocessState){case 0:a(c);c.preprocessState=1;return;case 1:return}if(c.getOpt("testChunks")&&!c.tested)c.test();else{c.xhr=new XMLHttpRequest;c.xhr.upload.addEventListener("progress",function(a){new Date-c.lastProgressCallback>1E3*c.getOpt("throttleProgressCallbacks")&&(c.callback("progress"),c.lastProgressCallback=new Date);c.loaded=a.loaded||0},!1);c.loaded=0;c.pendingRetry=!1;c.callback("progress");a=function(a){a=c.status();"success"==a||"error"==a?(c.callback(a,c.message()),
c.resumableObj.uploadNextChunk()):(c.callback("retry",c.message()),c.abort(),c.retries++,a=c.getOpt("chunkRetryInterval"),void 0!==a?(c.pendingRetry=!0,setTimeout(c.send,a)):c.send())};c.xhr.addEventListener("load",a,!1);c.xhr.addEventListener("error",a,!1);var b={resumableChunkNumber:c.offset+1,resumableChunkSize:c.getOpt("chunkSize"),resumableCurrentChunkSize:c.endByte-c.startByte,resumableTotalSize:c.fileObjSize,resumableType:c.fileObjType,resumableIdentifier:c.fileObj.uniqueIdentifier,resumableFilename:c.fileObj.fileName,
resumableRelativePath:c.fileObj.relativePath,resumableTotalChunks:c.fileObj.chunks.length},a=c.getOpt("query");"function"==typeof a&&(a=a(c.fileObj,c));f.each(a,function(c,a){b[c]=a});var a=c.fileObj.file[c.fileObj.file.slice?"slice":c.fileObj.file.mozSlice?"mozSlice":c.fileObj.file.webkitSlice?"webkitSlice":"slice"](c.startByte,c.endByte),d=null,e=c.getOpt("target");if("octet"===c.getOpt("method")){var d=a,g=[];f.each(b,function(c,a){g.push([encodeURIComponent(c),encodeURIComponent(a)].join("="))});
e=f.getTarget(g)}else d=new FormData,f.each(b,function(c,a){d.append(c,a)}),d.append(c.getOpt("fileParameterName"),a);c.xhr.open("POST",e);c.xhr.timeout=c.getOpt("xhrTimeout");c.xhr.withCredentials=c.getOpt("withCredentials");f.each(c.getOpt("headers"),function(a,b){c.xhr.setRequestHeader(a,b)});c.xhr.send(d)}};c.abort=function(){c.xhr&&c.xhr.abort();c.xhr=null};c.status=function(){if(c.pendingRetry)return"uploading";if(c.xhr){if(4>c.xhr.readyState)return"uploading";if(200==c.xhr.status)return"success";
if(f.contains(c.getOpt("permanentErrors"),c.xhr.status)||c.retries>=c.getOpt("maxChunkRetries"))return"error";c.abort()}return"pending"};c.message=function(){return c.xhr?c.xhr.responseText:""};c.progress=function(a){"undefined"===typeof a&&(a=!1);a=a?(c.endByte-c.startByte)/c.fileObjSize:1;if(c.pendingRetry)return 0;switch(c.status()){case "success":case "error":return 1*a;case "pending":return 0*a;default:return c.loaded/(c.endByte-c.startByte)*a}};return this}if(!(this instanceof h))return new h(l);
this.version=1;this.support="undefined"!==typeof File&&"undefined"!==typeof Blob&&"undefined"!==typeof FileList&&(!!Blob.prototype.webkitSlice||!!Blob.prototype.mozSlice||!!Blob.prototype.slice||!1);if(!this.support)return!1;var e=this;e.files=[];e.defaults={chunkSize:1048576,forceChunkSize:!1,simultaneousUploads:3,fileParameterName:"file",throttleProgressCallbacks:.5,query:{},headers:{},preprocess:null,method:"multipart",prioritizeFirstAndLastChunk:!1,target:"/",testChunks:!0,generateUniqueIdentifier:null,
maxChunkRetries:void 0,chunkRetryInterval:void 0,permanentErrors:[404,415,500,501],maxFiles:void 0,withCredentials:!1,xhrTimeout:0,maxFilesErrorCallback:function(b,d){var a=e.getOpt("maxFiles");alert("Please upload "+a+" file"+(1===a?"":"s")+" at a time.")},minFileSize:1,minFileSizeErrorCallback:function(b,d){alert(b.fileName||b.name+" is too small, please upload files larger than "+f.formatSize(e.getOpt("minFileSize"))+".")},maxFileSize:void 0,maxFileSizeErrorCallback:function(b,d){alert(b.fileName||
b.name+" is too large, please upload files less than "+f.formatSize(e.getOpt("maxFileSize"))+".")},fileType:[],fileTypeErrorCallback:function(b,d){alert(b.fileName||b.name+" has type not allowed, please upload files of type "+e.getOpt("fileType")+".")}};e.opts=l||{};e.getOpt=function(b){var d=this;if(b instanceof Array){var a={};f.each(b,function(b){a[b]=d.getOpt(b)});return a}if(d instanceof n){if("undefined"!==typeof d.opts[b])return d.opts[b];d=d.fileObj}if(d instanceof m){if("undefined"!==typeof d.opts[b])return d.opts[b];
d=d.resumableObj}if(d instanceof h)return"undefined"!==typeof d.opts[b]?d.opts[b]:d.defaults[b]};e.events=[];e.on=function(b,d){e.events.push(b.toLowerCase(),d)};e.fire=function(){var b=[],d;for(d=0;d<arguments.length;d++)b.push(arguments[d]);var a=b[0].toLowerCase();for(d=0;d<=e.events.length;d+=2)e.events[d]==a&&e.events[d+1].apply(e,b.slice(1)),"catchall"==e.events[d]&&e.events[d+1].apply(null,b);"fileerror"==a&&e.fire("error",b[2],b[1]);"fileprogress"==a&&e.fire("progress")};var f={stopEvent:function(b){b.stopPropagation();
b.preventDefault()},each:function(b,d){if("undefined"!==typeof b.length)for(var a=0;a<b.length&&!1!==d(b[a]);a++);else for(a in b)if(!1===d(a,b[a]))break},generateUniqueIdentifier:function(b){var d=e.getOpt("generateUniqueIdentifier");return"function"===typeof d?d(b):b.size+"-"+(b.webkitRelativePath||b.fileName||b.name).replace(/[^0-9a-zA-Z_-]/img,"")},contains:function(b,d){var a=!1;f.each(b,function(b){return b==d?(a=!0,!1):!0});return a},formatSize:function(b){return 1024>b?b+" bytes":1048576>
b?(b/1024).toFixed(0)+" KB":1073741824>b?(b/1024/1024).toFixed(1)+" MB":(b/1024/1024/1024).toFixed(1)+" GB"},getTarget:function(b){var d=e.getOpt("target"),d=0>d.indexOf("?")?d+"?":d+"&";return d+b.join("&")}},p=function(b){f.stopEvent(b);k(b.dataTransfer.files,b)},q=function(b){b.preventDefault()},k=function(b,d){var a=0,g=e.getOpt("maxFiles minFileSize maxFileSize maxFilesErrorCallback minFileSizeErrorCallback maxFileSizeErrorCallback fileType fileTypeErrorCallback".split(" "));if("undefined"!==
typeof g.maxFiles&&g.maxFiles<b.length+e.files.length)if(1===g.maxFiles&&1===e.files.length&&1===b.length)e.removeFile(e.files[0]);else return g.maxFilesErrorCallback(b,a++),!1;var c=[];f.each(b,function(b){var h=b.name.split("."),h=h[h.length-1].toLowerCase();if(0<g.fileType.length&&!f.contains(g.fileType,h))return g.fileTypeErrorCallback(b,a++),!1;if("undefined"!==typeof g.minFileSize&&b.size<g.minFileSize)return g.minFileSizeErrorCallback(b,a++),!1;if("undefined"!==typeof g.maxFileSize&&b.size>
g.maxFileSize)return g.maxFileSizeErrorCallback(b,a++),!1;e.getFromUniqueIdentifier(f.generateUniqueIdentifier(b))||function(){var a=new m(e,b);window.setTimeout(function(){e.files.push(a);c.push(a);a.container="undefined"!=typeof d?d.srcElement:null;e.fire("fileAdded",a,d)},0)}()});window.setTimeout(function(){e.fire("filesAdded",c)},0)};e.uploadNextChunk=function(){var b=!1;if(e.getOpt("prioritizeFirstAndLastChunk")&&(f.each(e.files,function(a){if(a.chunks.length&&"pending"==a.chunks[0].status()&&
0===a.chunks[0].preprocessState)return a.chunks[0].send(),b=!0,!1;if(1<a.chunks.length&&"pending"==a.chunks[a.chunks.length-1].status()&&0===a.chunks[a.chunks.length-1].preprocessState)return a.chunks[a.chunks.length-1].send(),b=!0,!1}),b))return!0;f.each(e.files,function(a){!1===a.isPaused()&&f.each(a.chunks,function(a){if("pending"==a.status()&&0===a.preprocessState)return a.send(),b=!0,!1});if(b)return!1});if(b)return!0;var d=!1;f.each(e.files,function(a){if(!a.isComplete())return d=!0,!1});d||
e.fire("complete");return!1};e.assignBrowse=function(b,d){"undefined"==typeof b.length&&(b=[b]);f.each(b,function(a){var b;"INPUT"===a.tagName&&"file"===a.type?b=a:(b=document.createElement("input"),b.setAttribute("type","file"),b.style.display="none",a.addEventListener("click",function(){b.style.opacity=0;b.style.display="block";b.focus();b.click();b.style.display="none"},!1),a.appendChild(b));a=e.getOpt("maxFiles");"undefined"===typeof a||1!=a?b.setAttribute("multiple","multiple"):b.removeAttribute("multiple");
d?b.setAttribute("webkitdirectory","webkitdirectory"):b.removeAttribute("webkitdirectory");b.addEventListener("change",function(a){k(a.target.files,a);a.target.value=""},!1)})};e.assignDrop=function(b){"undefined"==typeof b.length&&(b=[b]);f.each(b,function(b){b.addEventListener("dragover",q,!1);b.addEventListener("drop",p,!1)})};e.unAssignDrop=function(b){"undefined"==typeof b.length&&(b=[b]);f.each(b,function(b){b.removeEventListener("dragover",q);b.removeEventListener("drop",p)})};e.isUploading=
function(){var b=!1;f.each(e.files,function(d){if(d.isUploading())return b=!0,!1});return b};e.upload=function(){if(!e.isUploading()){e.fire("uploadStart");for(var b=1;b<=e.getOpt("simultaneousUploads");b++)e.uploadNextChunk()}};e.pause=function(){f.each(e.files,function(b){b.abort()});e.fire("pause")};e.cancel=function(){for(var b=e.files.length-1;0<=b;b--)e.files[b].cancel();e.fire("cancel")};e.progress=function(){var b=0,d=0;f.each(e.files,function(a){b+=a.progress()*a.size;d+=a.size});return 0<
d?b/d:0};e.addFile=function(b,d){k([b],d)};e.removeFile=function(b){for(var d=e.files.length-1;0<=d;d--)e.files[d]===b&&e.files.splice(d,1)};e.getFromUniqueIdentifier=function(b){var d=!1;f.each(e.files,function(a){a.uniqueIdentifier==b&&(d=a)});return d};e.getSize=function(){var b=0;f.each(e.files,function(d){b+=d.size});return b};return this};"undefined"!=typeof module?module.exports=h:"function"===typeof define&&define.amd?define(function(){return h}):window.Resumable=h})();