function refreshFilst(){window.location=window.location.href.split("#")[0]}function refreshFilstO(a){var b=window.location.href.split("#")[0].split("?");window.location=b[1]?b[0]+"?"+b[1].split("&")[0]+"&O="+a:b[0]+"?O="+a}function postAndRefresh(a){$.post(fmx_AJ,a,function(a,c,e){a?alert(a):refreshFilst()})}
var aMsgDlg={cselect:"#aMsgDlog",buttons:{"Okay`prm":function(){myCloseDlg(this)}}},aSchDlg={cselect:"#aSchDlog",buttons:{"Search`prm":function(){var a=document.myUIform;if(a.sterm.value.trim()){var b=a.sterm.value.trim(),c=document.forms.cliterm;"srhf"===a.cmd.value?(sessionStorage.fmx_strmf=b,c.cmdlin.value="find ./ -name "+b+" -ls"):(sessionStorage.fmx_strmc=b,c.cmdlin.value="grep -R -I "+b+" *");c.submit();myCloseDlg(this)}else alert("Please enter a valid search term")}}},fRenDlg={cselect:"#fRenDlog",
modal:!0,buttons:{"Rename`prm":function(){var a=document.myUIform;a.nunam.value.trim()?(a={act:"fren",fref:curDir+a.oldnm.value,nunm:curDir+a.nunam.value.trim()},myCloseDlg(this),postAndRefresh(a)):alert("Please enter a valid name")}}},fNamDlg={cselect:"#fNamDlog",buttons:{"Create`prm":function(){var a=document.myUIform;a.fref.value.trim()?(a={act:a.act.value,fref:curDir+a.fref.value.trim()},myCloseDlg(this),postAndRefresh(a)):alert("Please enter a valid name")}}},upldAction={H5w:function(){popUp(fmx_appPath+
"filupld5.php")},H5o:function(a){$("#upload").jqm({ajax:fmx_appPath+"filupld5.php?o=1",ajaxText:"Loading...",onLoad:a,onHide:function(a){refreshFilst()},target:".upldr",overlay:5}).jqmShow()},L4w:function(){popUp(fmx_appPath+"filupld.php")},L4o:function(){$("#upload").jqm({ajax:fmx_appPath+"filupld.php?o=1",ajaxText:"Loading...",onHide:function(a){refreshFilst()},target:".upldr",overlay:5}).jqmShow()}};
function downloadFile(a,b,c){a=fmx_appPath+"fildnld.php?fle="+encodeURI(a)+(b?"&tcdl=1&rad=Y":"")+(c?"&asf="+c:"");b=document.createElement("iframe");b.src=a;b.style.display="none";document.body.appendChild(b)}function makeFileList(a,b){var c=b?"<br />":" ",e="",d,g=a.split("\x00"),f,k=encodeURIComponent(curDir).length;for(d in g){var h=g[d].split("&");var l="";for(f in h){var m=h[f].split("=");0===1*f?l=m[1].substr(k):e+=l+"%2F"+m[1]+c}}return e.replace(/%2F/g,"/")}
function doesSupportAjaxUploadWithProgress(){var a;if(a="undefined"!==typeof window.FileList)a=new XMLHttpRequest,a=!!(a&&"upload"in a&&"onprogress"in a.upload);return a}function pop(a,b,c){return window.open(a,"","toolbar=no,status=no,location=no,menubar=no,resizable=0,scrollbars=1,width="+c+",height="+b+",left="+(screen.width-c)/2+",top="+(screen.height-b)/2)}
function popPost(a,b,c,e,d){var g="",f;for(f in b)g+='<input type="hidden" name="'+f+'" value="'+b[f]+'" />';a=$('<form action="'+a+'" method="post" target="'+c+'">'+g+"</form>");$(document.body).append(a);window.open("",c,"toolbar=no,status=no,location=no,menubar=no,resizable=0,scrollbars=1,width="+d+",height="+e+",left="+(screen.width-d)/2+",top="+(screen.height-e)/2).focus();a[0].submit()}function popUp(a){pop(a,240,416)}
function doMenuAction(a,b){var c=$(".fsel:checked"),e=c.length;var d=function(){if(e)if(1<e)alert("Please select only one item.");else return!0;else alert("An item needs to be selected");return!1};var g=function(){if(e)return!0;alert("Some items need to be selected");return!1};switch(a){case "cppa":e?(sessionStorage.fmx_cppa=$("form[name='filst']").serialize(),show_mcount("#cppaMenu",sessionStorage.fmx_cppa)):sessionStorage.fmx_cppa&&postAndRefresh("act=cppa&todr="+encodeURIComponent(curDir)+"&"+
sessionStorage.fmx_cppa);break;case "trsh":g()&&(1==e||confirm("You have multiple files selected. Are you sure you want to trash ALL the selected files?"))&&postAndRefresh("act=trsh&"+$("form[name='filst']").serialize());break;case "mpty":postAndRefresh("act=mpty");break;case "delf":g()&&(1==e||confirm("You have multiple files selected. Are you sure you want to delete ALL the selected files?"))&&postAndRefresh("act=delf&"+$("form[name='filst']").serialize());break;case "dnld":if(g()){var f="act=dnld&"+
$("form[name='filst']").serialize();$("div.dnldprg").css("display","inline");$.post(fmx_AJ,f,function(a,e,b){$("div.dnldprg").css("display","none");a?downloadFile(a.fpth,"Y"==a.rad,!1):alert("download not available")},"json")}break;case "dupl":d()&&(f={act:"dupl",fref:curDir+$(c[0]).parents("tr").attr("data-fref")},postAndRefresh(f));break;case "mark":f=void 0===sessionStorage.fmx_mrkd?"":sessionStorage.fmx_mrkd+"\x00";e&&(sessionStorage.fmx_mrkd=f+$("form[name='filst']").serialize(),bump_mcount("#markMenu",
e));break;case "mmiz":g()&&postAndRefresh("act=mmiz&"+$("form[name='filst']").serialize());break;case "mvto":e?(sessionStorage.fmx_mvto=$("form[name='filst']").serialize(),show_mcount("#mvtoMenu",sessionStorage.fmx_mvto)):sessionStorage.fmx_mvto?(f=sessionStorage.fmx_mvto,sessionStorage.removeItem("fmx_mvto"),postAndRefresh("act=mvto&todr="+encodeURIComponent(curDir)+"&"+f)):alert("Nothing previously selected to move");break;case "nfle":case "nfld":myOpenDlg(b,fNamDlg,{act:a},"nfle"==a?"New File":
"New Folder");break;case "refr":refreshFilst();break;case "rnam":d()&&(d=$(c[0]).parents("tr").attr("data-fref"),myOpenDlg(b,fRenDlg,{old:d,"new":d}));break;case "srhf":case "srhc":d=sessionStorage.fmx_strmf;"srhc"==a&&(d=sessionStorage.fmx_strmc);myOpenDlg(b,aSchDlg,{cmd:a,trm:d});break;case "turl":d()&&$("#upload").jqm({ajax:fmx_appPath+"filcurlm.php?t=1",ajaxText:"Loading...",target:".upldr",overlay:5}).jqmShow();break;case "furl":$("#upload").jqm({ajax:fmx_appPath+"filcurlm.php",ajaxText:"Loading...",
target:".upldr",overlay:5}).jqmShow();break;case "upld":doesSupportAjaxUploadWithProgress()?upload_winpop?upldAction.H5w():upldAction.H5o():upload_winpop?upldAction.L4w():upldAction.L4o();break;case "uzip":case "zip":case "tarz":case "utrz":if(d()){d=$(c[0]).parents("tr").attr("data-fref");g=document.forms.cliterm;if("zip"==a){var k="zip ";$(c[0]).parent().next().hasClass("foldCtxt")&&(k+="-r ");c=d.replace(/\s/g,"_");g.cmdlin.value=k+c+'.zip "'+d+'"';if(b.shiftKey)if(d=prompt("COMMAND:",g.cmdlin.value+
' -x "*/sv_*" -x "*/.git*"'))g.cmdlin.value=d;else break}else"uzip"==a?g.cmdlin.value='unzip "'+d+'"':"tarz"==a?(c=d.replace(/\s/g,"_"),g.cmdlin.value="tar -czf "+c+'.tgz "'+d+'"'):"utrz"==a&&(g.cmdlin.value='tar -xzf "'+d+'"');g.submit()}break;case "mgzp":d()&&(d=$(c[0]).parents("tr").attr("data-fref"),d=encodeURIComponent(curDir+d),doManageZip(d));break;case "webv":if(d()){d=$(c[0]).parents("tr").attr("data-fref");if(b.shiftKey&&(d=prompt("URL:",d),!d))break;c=ctxPrf+curDir.slice(curDir.search("/"));
pop(c+d,screen.availHeight,1200)}break;case "gitr":d()&&(".git"==$(c[0]).parents("tr").attr("data-fref")?(f="?dir="+curDir,pop(fmx_appPath+"gitter.php"+f,screen.availHeight,1200)):alert("Please select a '.git' folder"));break;case "jxtr":d()&&(d=curDir+$(c[0]).parents("tr").attr("data-fref"),(c=d.match(/([^\/\\]+)\.(\w+)$/))&&"xml"==c[2]?(f={act:"jxtr",fref:d,dir:curDir},$.post(fmx_AJ,f,function(a,e,b){a&&alert(a)})):alert("Must be an XML file"));break;case "sql3":if(!e||d())f="?dir="+curDir,e&&(f=
"?dbf="+curDir+$(c[0]).parents("tr").attr("data-fref")),pop(fmx_appPath+"pla/phpliteadmin.php"+f,screen.availHeight,.8*screen.availWidth);break;case "fmxi":f={act:"fmxi"};$.post(fmx_AJ,f,function(a,e,c){if(a){if(a.updt){var d=a.updt.split("|");e=$.extend(!0,{},aMsgDlg,{buttons:{"Update now":function(){confirm("It is a good idea to backup first. Do you want to continue with the update?")&&(f={act:"updt",nver:d[1]},$.post(fmx_AJ,f,function(a,e,b){a?alert(a):refreshFilst()}),myCloseDlg(this))}}})}else e=
aMsgDlg;myOpenDlg(b,e,{msg:a.msg},"FMX - Hosted File Manager")}},"json");break;case "cmcs":var h=document.createElement("div");h.id="util-view";d=document.createElement("div");d.innerHTML="Loading ...";h.style.left=b.clientX-60+"px";h.style.top=b.clientY-48+"px";h.appendChild(d);document.body.appendChild(h);f={act:"CLIC"};$(h).load(fmx_AJ,f,function(a,e,c){h.style.top=b.clientY-h.clientHeight-20+"px";$("#util-view div").click(function(a){a.preventDefault();doFillCLI($(this).attr("data-cmd"));document.body.removeChild(h)})});
break;case "mnu":break;default:alert("?"+a+"?")}}var editWindow;function doViewFile(a){pop(fmx_appPath+"filwin.php?fref="+a,675,900)}function doEditFile(a){editWindow=pop(fmx_appPath+"filedtwin.php?fref="+a,screen.availHeight,screen.availWidth)}function doEditImage(a){popPost(fmx_appPath+"imgedtwin.php",{fref:a},"imgedt",screen.availHeight,Math.min(1200,screen.availWidth))}function doManageZip(a){editWindow=pop(fmx_appPath+"arcview.php?fref="+a,.75*screen.availHeight,.5*screen.availWidth)}
function doFileAction(a,b,c){c&&(c.preventDefault(),c.stopPropagation());var e=$(b).parents("tr").attr("data-fref");b=encodeURIComponent(curDir+e);switch(a){case "finf":a={act:a,fref:b};$.post(fmx_AJ,a,function(a,b,f){a&&myOpenDlg(c,aMsgDlg,{msg:a},"File info for: "+e)});break;case "fvue":doViewFile(b);break;case "fedt":doEditFile(b);break;case "iedt":doEditImage(b);break;default:alert("?"+a+"?")}}function doFillCLI(a){$("#cmdlin").val(a)}
function allSelect(a,b){b.checked?$(".fsel").prop("checked",!0):$(".fsel").prop("checked",!1)}function fils2up(){if(""===document.cliterm.cmdlin.value)return alert("Please enter a command."),!1;var a=document.cliterm.cmdlin.value;0<a.indexOf("$$")&&(document.cliterm.cmdlin.value=a.replace("$$",makeFileList(sessionStorage.fmx_mrkd,!1)));document.cliterm.submit();return!0}
function selectionAction(a){var b="";"undefined"!==window.getSelection?b=window.getSelection():"undefined"!==document.selection&&"Text"==document.selection.type&&(b=document.selection.createRange().text);b=curDir+b;a?doEditFile(b):doViewFile(b)}function display_cmmStorage(a){if(a){var b="";a=a.split("\x00");for(var c in a)for(var e=decodeURIComponent(a[c]).split("&"),d=0;d<e.length;d++)0<d&&(b+="    "),b+=e[d]+"\n";alert(b)}else alert("[ empty ]")}
function show_mcount(a,b){var c=$(a).html().split("(");if(b){var e=b.split("\x00"),d=0,g;for(g in e)for(var f=decodeURIComponent(e[g]).split("&"),k=0;k<f.length;k++)k&&d++;$(a).html(c[0]+"("+d+")")}else $(a).html(c[0])}function bump_mcount(a,b){var c=$(a).html(),e=c.split("(");0>b?$(a).html(e[0]):e[1]?(c=e[1],c=c.substr(0,c.length-1),$(a).html(e[0]+"("+(+c+b)+")")):$(a).html(c+"("+b+")")}
function cm_del(a,b){var c=$(a).parents("tr").attr("data-fref");confirm("Are you sure you want to delete this "+(b?"folder and contents":"file")+": "+c+" ?")&&postAndRefresh({act:"delf",dir:curDir,"files[]":c})}function cm_dld(a,b){var c={act:"dnld",dir:curDir,"files[]":$(a).parents("tr").attr("data-fref")+(b?"/":"")};$.post(fmx_AJ,c,function(a,b,c){a?downloadFile(a.fpth,"Y"==a.rad,!1):alert("download not available")},"json")}
function cm_dup(a,b){var c={act:"dupl",fref:curDir+$(a).parents("tr").attr("data-fref")};postAndRefresh(c)}function cm_ren(a){a=$(a).parents("tr").attr("data-fref");myOpenDlg(null,fRenDlg,{old:a,"new":a})}function cm_zip(a,b){var c=$(a).parents("tr").attr("data-fref"),e=document.forms.cliterm,d="zip ";b&&(d+="-r ");var g=c.replace(/\s/g,"_");e.cmdlin.value=d+g+'.zip "'+c+'"';e.submit()}
function cm_slnk(){if(sessionStorage.fmx_mrkd){var a=sessionStorage.fmx_mrkd.split("\x00");if(1!=a.length)alert("Can SymLink to only one location at a time");else{var b=a[0].split("&"),c=b[0].split("=");a=c[1].replace(/%2F/g,"/");c=b[1].split("=");b=c[1].replace(/%2F/g,"/");c=prompt("Link to marked:","");null!==c&&postAndRefresh({act:"slnk",fref:a+"/"+b,tref:curDir,alnk:c})}}else alert("Mark something to link first")}
$(function(){try{sessionStorage.fmx_ok=1}catch(e){alert("Your browser 'sessionStorage' is not functioning. (private browsing?) Not all functions of FMX will work successfully.")}sessionStorage.fmx_curD=curDir;$("#fmnu [data-mnu]").click(function(a){a.preventDefault();doMenuAction($(this).attr("data-mnu"),a)});$("#footerPopContent [data-mnu]").click(function(a){a.preventDefault();doMenuAction($(this).attr("data-mnu"),a)});$("#ftbl [data-act]").click(function(a){a.preventDefault();doFileAction($(this).attr("data-act"),
this,a)});$("nav li ul").hide().removeClass("fallback");$("nav li").hover(function(){$("ul",this).stop(!0,!0).fadeToggle(100)});var a=$(".fsel"),b=null;a.click(function(e){if(b){if(e.shiftKey){e=a.index(this);var c=a.index(b);a.slice(Math.min(e,c),Math.max(e,c)+1).prop("checked",b.checked)}b=this;if(this.checked){var g=0;$(".fsel").each(function(){this.checked||(g=1)});0===g&&$("#checkAll").prop("checked",!0)}else $("#checkAll").prop("checked",!1)}else b=this});show_mcount("#cppaMenu",sessionStorage.fmx_cppa);
show_mcount("#markMenu",sessionStorage.fmx_mrkd);show_mcount("#mvtoMenu",sessionStorage.fmx_mvto);$("a.cppaMenu").contextMenu("clrdMenu",{bindings:{clrdClr:function(a){sessionStorage.removeItem("fmx_cppa");bump_mcount("#cppaMenu",-1)},clrdDsp:function(a){display_cmmStorage(sessionStorage.fmx_cppa)}}});$("a.delfMenu").contextMenu("delfMenu",{bindings:{delfTrue:function(a){doMenuAction("delf",null)},delfMpty:function(a){doMenuAction("mpty",null)}}});$("a.markMenu").contextMenu("clrdMenuSL",{bindings:{clrdClr:function(a){sessionStorage.removeItem("fmx_mrkd");
bump_mcount("#markMenu",-1)},clrdDsp:function(a){display_cmmStorage(sessionStorage.fmx_mrkd)},symLnk:function(a){cm_slnk()}}});$("a.mvtoMenu").contextMenu("clrdMenu",{bindings:{clrdClr:function(a){sessionStorage.removeItem("fmx_mvto");bump_mcount("#mvtoMenu",-1)},clrdDsp:function(a){display_cmmStorage(sessionStorage.fmx_mvto)}}});$("a.upldMenu").contextMenu("upldMenu",{onContextMenu:function(a){return!0},bindings:{H5w:function(a){upldAction.H5w()},H5o:function(a){upldAction.H5o()},L4w:function(a){upldAction.L4w()},
L4o:function(a){upldAction.L4o()},Chk:function(a){upldAction.Chk()}}});$("td.fileCtxt").contextMenu("fileCtxt",{bindings:{cfi_edt:function(a){doFileAction("fedt",a,null)},cfi_del:function(a){cm_del(a,!1)},cfi_dld:function(a){cm_dld(a,!1)},cfi_dup:function(a){cm_dup(a,!1)},cfi_ren:function(a){cm_ren(a)},cfi_zip:function(a){cm_zip(a,!1)}}});$("td.foldCtxt").contextMenu("foldCtxt",{bindings:{cfo_del:function(a){cm_del(a,!0)},cfo_dld:function(a){cm_dld(a,!0)},cfo_dup:function(a){cm_dup(a,!0)},cfo_ren:function(a){cm_ren(a)},
cfo_zip:function(a){cm_zip(a,!0)}}});var c=$("#filsform");c.on("drag dragstart dragend dragover dragenter dragleave drop",function(a){a.preventDefault();a.stopPropagation()}).on("dragover dragenter",function(){c.addClass("upld-body")}).on("dragleave dragend drop",function(){c.removeClass("upld-body")}).on("drop",function(a){var b=a.originalEvent.dataTransfer.files;upldAction.H5o(function(){fupQadd2(b)})})});