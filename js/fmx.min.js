function refreshFilst(){window.location.reload()}function postAndRefresh(a){$.post("fmxjx.php",a,function(a,b,f){a?alert(a):refreshFilst()})}
var aMsgDlg={cselect:"#aMsgDlog",buttons:{"Okay`prm":function(){myCloseDlg(this)}}},aSchDlg={cselect:"#aSchDlog",buttons:{"Search`prm":function(){var a=document.myUIform;if(a.sterm.value.trim()){var c=a.sterm.value.trim(),b=document.forms.cliterm;"srhf"===a.cmd.value?(sessionStorage.fmx_strmf=c,b.cmdlin.value="find ./ -name "+c+" -ls"):(sessionStorage.fmx_strmc=c,b.cmdlin.value="grep -R -I "+c+" *");b.submit();myCloseDlg(this)}else alert("Please enter a valid search term")}}},fRenDlg={cselect:"#fRenDlog",
modal:!0,buttons:{"Rename`prm":function(){var a=document.myUIform;a.nunam.value.trim()?(a={act:"fren",fref:curDir+a.oldnm.value,nunm:curDir+a.nunam.value.trim()},myCloseDlg(this),postAndRefresh(a)):alert("Please enter a valid name")}}},fNamDlg={cselect:"#fNamDlog",buttons:{"Create`prm":function(){var a=document.myUIform;a.fref.value.trim()?(a={act:a.act.value,fref:curDir+a.fref.value.trim()},myCloseDlg(this),postAndRefresh(a)):alert("Please enter a valid name")}}},fCpmDlg={cselect:"#fCpmDlog",buttons:{"{CM}":function(){var a=
document.myUIform;a.cpm2nam.value.trim()?(a={act:a.act.value,fref:a.cpmfnm.value,tonm:a.cpm2nam.value.trim()},myCloseDlg(this),postAndRefresh(a)):alert("Please enter a valid path")}}};function downloadFile(a,c,b){a="fildnld.php?fle="+escape(a)+(c?"&tcdl=1&rad=Y":"")+(b?"&asf="+b:"");c=document.createElement("iframe");c.src=a;c.style.display="none";document.body.appendChild(c)}
function makeFileList(a,c){var b=c?"<br />":" ",f="",d,e=a.split("\x00"),h,g,k,l;for(d in e)for(k in h=e[d].split("&"),g="",h)l=h[k].split("="),0==k?g="/"+l[1]:f+=g+"%2F"+l[1]+b;return f.replace(/%2F/g,"/")}function doesSupportAjaxUploadWithProgress(){function a(){var a=new XMLHttpRequest;return!!(a&&a.hasOwnProperty("upload")&&a.upload.hasOwnProperty("onprogress"))}return function(){var a=document.createElement("INPUT");a.type="file";return a.hasOwnProperty("files")}()&&a()}
function pop(a,c,b){return window.open(a,"","toolbar=no,status=no,location=no,menubar=no,resizable=0,scrollbars=1,width="+b+",height="+c+",left="+(screen.width-b)/2+",top="+(screen.height-c)/2)}function popUp(a){pop(a,240,416)}
function doMenuAction(a,c){var b=$(".fsel:checked"),f=b.length,d,e,h;e=function(){if(f)if(1<f)alert("Please select only one item.");else return!0;else alert("An item needs to be selected");return!1};h=function(){if(f)return!0;alert("Some items need to be selected");return!1};switch(a){case "copy":e()&&(b=curDir+$(b[0]).parents("tr").attr("data-fref"),myOpenDlg(c,$.extend({},fCpmDlg,{bover:{"{CM}":"Copy`prm"}}),{act:a,cpm:b},"Copy:"));break;case "cppa":if(c.altKey){alert(sessionStorage.fmx_cppa);break}f?
sessionStorage.fmx_cppa=$("form[name='filst']").serialize():(d="act=cppa&todr="+encodeURIComponent(curDir)+"&"+sessionStorage.fmx_cppa,$.post("fmxjx.php",d,function(a,b,c){a?alert(a):refreshFilst()}));break;case "delf":h()&&(1==f||confirm("You have multiple files selected. Are you sure you want to delete ALL the selected files?"))&&(d="act=delf&"+$("form[name='filst']").serialize(),$.post("fmxjx.php",d,function(a,b,c){a?alert(a):refreshFilst()}));break;case "dnld":h()&&(d="act=dnld&"+$("form[name='filst']").serialize(),
$("div.dnldprg").css("display","inline"),$.post("fmxjx.php",d,function(a,b,c){$("div.dnldprg").css("display","none");a?downloadFile(a.fpth,"Y"==a.rad,!1):alert("download not available")},"json"));break;case "dupl":e()&&(d={act:"dupl",fref:curDir+$(b[0]).parents("tr").attr("data-fref")},$.post("fmxjx.php",d,function(a,b,c){a?alert(a):refreshFilst()}));break;case "mark":d=sessionStorage.fmx_mrkd?sessionStorage.fmx_mrkd+"\x00":"";f?sessionStorage.fmx_mrkd=d+$("form[name='filst']").serialize():($("#fMrk").html(sessionStorage.fmx_mrkd?
makeFileList(sessionStorage.fmx_mrkd,!0):"&lt;empty&gt;"),$("#fMrkDlg").dialog("open"));break;case "move":e()&&(b=curDir+$(b[0]).parents("tr").attr("data-fref"),myOpenDlg(c,$.extend({},fCpmDlg,{bover:{"{CM}":"Move`prm"}}),{act:a,cpm:b},"Move:"));break;case "mvto":if(f)sessionStorage.fmx_mvto=$("form[name='filst']").serialize();else{if(!sessionStorage.fmx_mvto){alert("Nothing previously selected to move");break}d="act=mvto&todr="+encodeURIComponent(curDir)+"&"+sessionStorage.fmx_mvto;$.post("fmxjx.php",
d,function(a,b,c){a?alert(a):refreshFilst()})}break;case "nfle":case "nfld":myOpenDlg(c,fNamDlg,{act:a},"nfle"==a?"New File":"New Folder");break;case "refr":refreshFilst();break;case "rnam":e()&&(b=$(b[0]).parents("tr").attr("data-fref"),myOpenDlg(c,fRenDlg,{old:b,"new":b}));break;case "srhf":case "srhc":b=sessionStorage.fmx_strmf;"srhc"==a&&(b=sessionStorage.fmx_strmc);myOpenDlg(c,aSchDlg,{cmd:a,trm:b});break;case "upld":doesSupportAjaxUploadWithProgress()?(sessionStorage.fmx_curD=curDir,$("#upload").jqm({ajax:"filupld5dm.php",
ajaxText:"Loading...",target:".upldr",overlay:5}).jqmShow()):popUp("filupld.php?path="+curDir);break;case "uzip":case "zip":case "tarz":case "utrz":e()&&(b=$(b[0]).parents("tr").attr("data-fref"),e=document.forms.cliterm,"zip"==a?(h=b.replace(/\s/g,"_"),e.cmdlin.value="zip -r "+h+' "'+b+'"'):"uzip"==a?e.cmdlin.value='unzip "'+b+'"':"tarz"==a?(h=b.replace(/\s/g,"_"),e.cmdlin.value="tar -czf "+h+'.tgz "'+b+'"'):"utrz"==a&&(e.cmdlin.value='tar -xzf "'+b+'"'),e.submit());break;case "webv":if(e()){b=$(b[0]).parents("tr").attr("data-fref");
if(c.shiftKey&&(b=prompt("URL:",b),!b))break;e=curDir.slice(curDir.search("/"));pop(e+b,screen.availHeight,1200)}break;case "jxtr":e()&&(b=curDir+$(b[0]).parents("tr").attr("data-fref"),(e=b.match(/([^\/\\]+)\.(\w+)$/))&&"xml"==e[2]?(d={act:"jxtr",fref:b,dir:curDir},$.post("fmxjx.php",d,function(a,b,c){a&&alert(a)})):alert("Must be an XML file"));break;case "fmxi":d={act:"fmxi"};$.post("fmxjx.php",d,function(a,b,e){if(a){if(a.updt){var f=a.updt.split("|");b=$.extend(!0,{},aMsgDlg,{buttons:{"Update now":function(){confirm("It is a good idea to backup first. Do you want to continue with the update?")&&
(d={act:"updt",nver:f[1]},$.post("fmxjx.php",d,function(a,b,c){a?alert(a):refreshFilst()}),myCloseDlg(this))}}})}else b=aMsgDlg;myOpenDlg(c,b,{msg:a.msg},"FMX - Hosted File Manager")}},"json");break;case "cmcs":var g=document.createElement("div");g.id="util-view";b=document.createElement("div");b.innerHTML="Loading ...";g.style.left=c.clientX-60+"px";g.style.top=c.clientY-48+"px";g.appendChild(b);document.body.appendChild(g);d={act:"CLIC"};$(g).load("fmxjx.php",d,function(a,b,d){g.style.top=c.clientY-
g.clientHeight-20+"px";$("#util-view div").click(function(a){a.preventDefault();doFillCLI($(this).attr("data-cmd"));document.body.removeChild(g)})});break;case "mnu":break;default:alert("?"+a+"?")}}var editWindow;function doViewFile(a){pop("filwin.php?fref="+a,600,800)}function doEditFile(a){editWindow=pop("filedtwin.php?fref="+a,screen.availHeight,screen.availWidth)}
function doFileAction(a,c,b){b.preventDefault();b.stopPropagation();var f=escape($(c).parents("tr").attr("data-fref"));c=curDir+f;switch(a){case "finf":a={act:a,fref:c};$.post("fmxjx.php",a,function(a,c,h){a&&myOpenDlg(b,aMsgDlg,{msg:a},"File info for: "+f)});break;case "fvue":doViewFile(c);break;case "fedt":doEditFile(c);break;default:alert("?"+a+"?")}}function doFillCLI(a){$("#cmdlin").val(a)}function allSelect(a,c){c.checked?$(".fsel").prop("checked",!0):$(".fsel").prop("checked",!1)}
function fils2up(){if(""===document.cliterm.cmdlin.value)return alert("Please enter a command."),!1;var a=document.cliterm.cmdlin.value;0<a.indexOf("$$")&&(document.cliterm.cmdlin.value=a.replace("$$",makeFileList(sessionStorage.fmx_mrkd,!1)));document.cliterm.submit();return!0}
function selectionAction(a){var c="";"undefined"!==window.getSelection?c=window.getSelection():"undefined"!==document.selection&&"Text"==document.selection.type&&(c=document.selection.createRange().text);c=curDir+c;a?doEditFile(c):doViewFile(c)}
$(function(){$("#fmnu [data-mnu]").click(function(a){a.preventDefault();doMenuAction($(this).attr("data-mnu"),a)});$("#trmfrm [data-mnu]").click(function(a){a.preventDefault();doMenuAction($(this).attr("data-mnu"),a)});$("#ftbl [data-act]").click(function(a){a.preventDefault();doFileAction($(this).attr("data-act"),this,a)});$("nav li ul").hide().removeClass("fallback");$("nav li").hover(function(){$("ul",this).stop(!0,!0).fadeToggle(100)})});