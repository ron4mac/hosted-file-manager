$(function(){$("#fmnu [data-mnu]").click(function(a){a.preventDefault();doMenuAction($(this).attr("data-mnu"),a)});$("#trmfrm [data-mnu]").click(function(a){a.preventDefault();doMenuAction($(this).attr("data-mnu"),a)});$("#ftbl [data-act]").click(function(a){a.preventDefault();doFileAction($(this).attr("data-act"),this,a)});$("nav li ul").hide().removeClass("fallback");$("nav li").hover(function(){$("ul",this).stop(true,true).fadeToggle(100)})});var aMsgDlg={cselect:"#aMsgDlog",buttons:{"Okay`prm":function(){myCloseDlg(this)}}};var aSchDlg={cselect:"#aSchDlog",buttons:{"Search`prm":function(){var d=document.myUIform;if(!d.sterm.value.trim()){alert("Please enter a valid search term");return}var b=d.sterm.value.trim(),c=d.cmd.value,a=document.forms.cliterm;if(c==="srhf"){sessionStorage.fmx_strmf=b;a.cmdlin.value="find ./ -name "+b+" -ls"}else{sessionStorage.fmx_strmc=b;a.cmdlin.value="grep -R -I "+b+" *"}a.submit();myCloseDlg(this)}}};var fRenDlg={cselect:"#fRenDlog",modal:true,buttons:{"Rename`prm":function(){var b=document.myUIform;if(!b.nunam.value.trim()){alert("Please enter a valid name");return}var a={act:"fren",fref:curDir+b.oldnm.value,nunm:curDir+b.nunam.value.trim()};myCloseDlg(this);postAndRefresh(a)}}};var fNamDlg={cselect:"#fNamDlog",buttons:{"Create`prm":function(){var b=document.myUIform;if(!b.fref.value.trim()){alert("Please enter a valid name");return}var a={act:b.act.value,fref:curDir+b.fref.value.trim()};myCloseDlg(this);postAndRefresh(a)}}};var fCpmDlg={cselect:"#fCpmDlog",buttons:{"{CM}":function(){var b=document.myUIform;if(!b.cpm2nam.value.trim()){alert("Please enter a valid path");return}var a={act:b.act.value,fref:b.cpmfnm.value,tonm:b.cpm2nam.value.trim()};myCloseDlg(this);postAndRefresh(a)}}};function postAndRefresh(a){$.post("fmxjx.php",a,function(c,d,b){if(c){alert(c)}else{refreshFilst()}})}function refreshFilst(){window.location.reload()}function doMenuAction(d,p){var k=$(".fsel:checked"),b=k.length,o,f,a,q,i=function(){if(!b){alert("An item needs to be selected")}else{if(b>1){alert("Please select only one item.")}else{return true}}return false},e=function(){if(b){return true}alert("Some items need to be selected");return false};switch(d){case"copy":if(i()){f=curDir+$(k[0]).parents("tr").attr("data-fref");myOpenDlg(p,$.extend({},fCpmDlg,{bover:{"{CM}":"Copy`prm"}}),{act:d,cpm:f},"Copy:")}break;case"cppa":if(p.altKey){alert(sessionStorage.fmx_cppa);break}if(b){sessionStorage.fmx_cppa=$("form[name='filst']").serialize()}else{o="act=cppa&todr="+encodeURIComponent(curDir)+"&"+sessionStorage.fmx_cppa;$.post("fmxjx.php",o,function(s,t,m){if(s){alert(s)}else{refreshFilst()}})}break;case"delf":if(!e()){break}if((b>1)&&!confirm("You have multiple files selected. Are you sure you want to delete ALL the selected files?")){break}o="act=delf&"+$("form[name='filst']").serialize();$.post("fmxjx.php",o,function(s,t,m){if(s){alert(s)}else{refreshFilst()}});break;case"dnld":if(!e()){break}o="act=dnld&"+$("form[name='filst']").serialize();$("div.dnldprg").css("display","inline");$.post("fmxjx.php",o,function(s,t,m){$("div.dnldprg").css("display","none");if(s){downloadFile(s.fpth,s.rad=="Y",false)}else{alert("download not available")}},"json");break;case"dupl":if(i()){o={act:"dupl",fref:curDir+$(k[0]).parents("tr").attr("data-fref")};$.post("fmxjx.php",o,function(s,t,m){if(s){alert(s)}else{refreshFilst()}})}break;case"mark":o=sessionStorage.fmx_mrkd?(sessionStorage.fmx_mrkd+"\0"):"";if(b){sessionStorage.fmx_mrkd=o+$("form[name='filst']").serialize()}else{$("#fMrk").html(sessionStorage.fmx_mrkd?makeFileList(sessionStorage.fmx_mrkd,true):"&lt;empty&gt;");$("#fMrkDlg").dialog("open")}break;case"move":if(i()){f=curDir+$(k[0]).parents("tr").attr("data-fref");myOpenDlg(p,$.extend({},fCpmDlg,{bover:{"{CM}":"Move`prm"}}),{act:d,cpm:f},"Move:")}break;case"mvto":if(b){sessionStorage.fmx_mvto=$("form[name='filst']").serialize()}else{if(!sessionStorage.fmx_mvto){alert("Nothing previously selected to move");break}o="act=mvto&todr="+encodeURIComponent(curDir)+"&"+sessionStorage.fmx_mvto;$.post("fmxjx.php",o,function(s,t,m){if(s){alert(s)}else{refreshFilst()}})}break;case"nfle":case"nfld":myOpenDlg(p,fNamDlg,{act:d},d=="nfle"?"New File":"New Folder");break;case"refr":refreshFilst();break;case"rnam":if(!i()){break}f=$(k[0]).parents("tr").attr("data-fref");myOpenDlg(p,fRenDlg,{old:f,"new":f});break;case"srhf":case"srhc":var j="file";var n=sessionStorage.fmx_strmf;if(d=="srhc"){j="content";n=sessionStorage.fmx_strmc}myOpenDlg(p,aSchDlg,{cmd:d,trm:n});break;case"upld":if(doesSupportAjaxUploadWithProgress()){sessionStorage.fmx_curD=curDir;$("#upload").jqm({ajax:"filupld5dm.php",ajaxText:"Loading...",target:".upldr",overlay:5}).jqmShow()}else{popUp("filupld.php?path="+curDir)}break;case"uzip":case"zip":case"tarz":case"utrz":if(i()){f=$(k[0]).parents("tr").attr("data-fref");a=document.forms.cliterm;if(d=="zip"){q=f.replace(/\s/g,"_");a.cmdlin.value="zip -r "+q+' "'+f+'"'}else{if(d=="uzip"){a.cmdlin.value='unzip "'+f+'"'}else{if(d=="tarz"){q=f.replace(/\s/g,"_");a.cmdlin.value="tar -czf "+q+'.tgz "'+f+'"'}else{if(d=="utrz"){a.cmdlin.value='tar -xzf "'+f+'"'}}}}a.submit()}break;case"webv":if(i()){f=$(k[0]).parents("tr").attr("data-fref");if(p.shiftKey){var l=prompt("URL:",f);if(l){f=l}else{break}}var r=curDir.slice(curDir.search("/"));pop(r+f,screen.availHeight,1200)}break;case"jxtr":if(i()){f=curDir+$(k[0]).parents("tr").attr("data-fref");var c=f.match(/([^\/\\]+)\.(\w+)$/);if(c&&c[2]=="xml"){o={act:"jxtr",fref:f,dir:curDir};$.post("fmxjx.php",o,function(s,t,m){if(s){alert(s)}})}else{alert("Must be an XML file")}}break;case"fmxi":o={act:"fmxi"};$.post("fmxjx.php",o,function(s,t,m){if(s){alert(s)}});break;case"updt":o={act:"updt"};$.post("fmxjx.php",o,function(s,t,m){if(s){if(confirm("Update available: "+s+"\n\nPerform update?")){o={act:"updt",nver:s};$.post("fmxjx.php",o,function(v,w,u){if(v){alert(v)}else{refreshFilst()}})}}else{alert("No updates available.")}});break;case"cmcs":console.log(p);var h=document.createElement("div");h.id="util-view";var g=document.createElement("div");g.innerHTML="Loading ...";h.style.left=(p.clientX-60)+"px";h.style.top=(p.clientY-48)+"px";h.appendChild(g);document.body.appendChild(h);o={act:"CLIC"};$(h).load("fmxjx.php",o,function(s,t,m){h.style.top=(p.clientY-h.clientHeight-20)+"px";$("#util-view div").click(function(u){u.preventDefault();doFillCLI($(this).attr("data-cmd"));document.body.removeChild(h)})});break;case"mnu":break;default:alert("?"+d+"?");break}}var editWindow;function doViewFile(a){var b="filwin.php?fref="+a;pop(b,600,800)}function doEditFile(b){var a="filedtwin.php?fref="+b;editWindow=pop(a,screen.availHeight,screen.availWidth)}function doFileAction(b,e,a){a.preventDefault();a.stopPropagation();var f=escape($(e).parents("tr").attr("data-fref"));var d=curDir+f;var c;switch(b){case"finf":c={act:b,fref:d};$.post("fmxjx.php",c,function(h,i,g){if(h){myOpenDlg(a,aMsgDlg,{msg:h},"File info for: "+f)}});break;case"fvue":doViewFile(d);break;case"fedt":doEditFile(d);break;default:alert("?"+b+"?");break}}function doFillCLI(a){$("#cmdlin").val(a)}function downloadFile(a,d,c){var b="fildnld.php?fle="+escape(a)+(d?"&tcdl=1&rad=Y":"")+(c?("&asf="+c):"");var e=document.createElement("iframe");e.src=b;e.style.display="none";document.body.appendChild(e)}function pop(d,e,b){var c=(screen.height-e)/2;var a=(screen.width-b)/2;var f="toolbar=no,status=no,location=no,menubar=no,resizable=0,scrollbars=1,width="+b+",height="+e+",left="+a+",top="+c;return open(d,"",f)}function popUp(a){var b=pop(a,240,416)}function allSelect(a,b){if(b.checked){$(".fsel").attr("checked",true)}else{$(".fsel").removeAttr("checked")}}function doesSupportAjaxUploadWithProgress(){function a(){var c=document.createElement("INPUT");c.type="file";return c.hasOwnProperty("files")}function b(){var c=new XMLHttpRequest();return !!(c&&(c.hasOwnProperty("upload"))&&(c.upload.hasOwnProperty("onprogress")))}return a()&&b()}function fils2up(){if(document.cliterm.cmdlin.value===""){alert("Please enter a command.");return false}else{var a=document.cliterm.cmdlin.value;if(a.indexOf("$$")>0){document.cliterm.cmdlin.value=a.replace("$$",makeFileList(sessionStorage.fmx_mrkd,false))}document.cliterm.submit();return true}}function makeFileList(a,e){var j=e?"<br />":" ";var f="";var h=a.split("\0");for(var g in h){var c=h[g].split("&");var d="";for(var b in c){var i=c[b].split("=");if(b==0){d="/"+i[1]}else{f+=d+"%2F"+i[1]+j}}}return f.replace(/%2F/g,"/")}function selectionAction(b){var c="";if(window.getSelection!=="undefined"){c=window.getSelection()}else{if(document.selection!=="undefined"){if(document.selection.type=="Text"){c=document.selection.createRange().text}}}var a=curDir+c;if(b){doEditFile(a)}else{doViewFile(a)}};