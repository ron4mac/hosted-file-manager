$(function(){$("#fmnu [data-mnu]").click(function(a){a.preventDefault();doMenuAction($(this).attr("data-mnu"),a)});$("#trmfrm [data-mnu]").click(function(a){a.preventDefault();doMenuAction($(this).attr("data-mnu"),a)});$("#ftbl [data-act]").click(function(a){a.preventDefault();doFileAction($(this).attr("data-act"),this,a)});$("#aMsgDlg").dialog({autoOpen:false,width:600,position:[200,100],buttons:{Okay:function(){$(this).dialog("close")},Cancel:function(){$(this).dialog("close")}}});$("#fMrkDlg").dialog({autoOpen:false,width:600,position:[200,100],buttons:{Okay:function(){$(this).dialog("close")},Clear:function(){sessionStorage.removeItem("fmx_mrkd");$(this).dialog("close")}}});$("#fRenDlg").dialog({autoOpen:false,width:400,position:[100,100],buttons:{Cancel:function(){$(this).dialog("close")},Rename:function(){parms={act:"fren",fref:curDir+$("#oldnm").val(),nunm:curDir+$("#nunam").val()};$(this).dialog("close");$.post("fmxjx.php",parms,function(b,c,a){if(b){alert(b)}else{refreshFilst()}})}}});$("#fCpyDlg").dialog({autoOpen:false,width:500,position:[100,100],buttons:{Cancel:function(){$(this).dialog("close")},Copy:function(){parms={act:"copy",fref:$("#cpyfnm").val(),tonm:$("#cpy2nam").val()};$(this).dialog("close");$.post("fmxjx.php",parms,function(b,c,a){if(b){alert(b)}else{refreshFilst()}})}}});$("#fMovDlg").dialog({autoOpen:false,width:500,position:[100,100],buttons:{Cancel:function(){$(this).dialog("close")},Move:function(){parms={act:"move",fref:$("#movfnm").val(),tonm:$("#mov2nam").val()};$(this).dialog("close");$.post("fmxjx.php",parms,function(b,c,a){if(b){alert(b)}else{refreshFilst()}})}}});$("#fNamDlg").dialog({autoOpen:false,width:400,position:[100,100],buttons:{Cancel:function(){$(this).dialog("close")},Create:function(){parms={act:$("#ffact").val(),fref:curDir+$("#ffnam").val()};$(this).dialog("close");$.post("fmxjx.php",parms,function(b,c,a){if(b){alert(b)}else{refreshFilst()}})}}});$("nav li ul").hide().removeClass("fallback");$("nav li").hover(function(){$("ul",this).stop(true,true).fadeToggle(100)})});function refreshFilst(){window.location.reload()}function doMenuAction(n,i){var b=$(".fsel:checked");var p=b.length;var e,r,a,c;var l=function(){if(!p){alert("An item needs to be selected")}else{if(p>1){alert("Please select only one item.")}else{return true}}return false};var g=function(){if(p){return true}alert("Some items need to be selected");return false};switch(n){case"copy":if(l()){r=curDir+$(b[0]).parents("tr").attr("data-fref");$("#cpyfnm").val(r);$("#cpyfnam").html("From: "+r);$("#cpy2nam").val(r);$("#fCpyDlg").dialog("open")}break;case"cppa":if(i.altKey){alert(sessionStorage.fmx_cppa);break}if(p){sessionStorage.fmx_cppa=$("form[name='filst']").serialize()}else{e="act=cppa&todr="+encodeURIComponent(curDir)+"&"+sessionStorage.fmx_cppa;$.post("fmxjx.php",e,function(t,u,m){if(t){alert(t)}else{refreshFilst()}})}break;case"delf":if(!g()){break}if(!confirm("Are you sure you want to delete the selected files?")){break}e="act=delf&"+$("form[name='filst']").serialize();$.post("fmxjx.php",e,function(t,u,m){if(t){alert(t)}else{refreshFilst()}});break;case"dnld":if(!g()){break}e="act=dnld&"+$("form[name='filst']").serialize();$("div.dnldprg").css("display","inline");$.post("fmxjx.php",e,function(t,u,m){$("div.dnldprg").css("display","none");if(t){downloadFile(t.fpth,t.rad=="Y",false)}else{alert("download not available")}},"json");break;case"dupl":if(l()){e={act:"dupl",fref:curDir+$(b[0]).parents("tr").attr("data-fref")};$.post("fmxjx.php",e,function(t,u,m){if(t){alert(t)}else{refreshFilst()}})}break;case"mark":e=sessionStorage.fmx_mrkd?(sessionStorage.fmx_mrkd+"\0"):"";if(p){sessionStorage.fmx_mrkd=e+$("form[name='filst']").serialize()}else{$("#fMrk").html(sessionStorage.fmx_mrkd?makeFileList(sessionStorage.fmx_mrkd,true):"&lt;empty&gt;");$("#fMrkDlg").dialog("open")}break;case"move":if(l()){r=curDir+$(b[0]).parents("tr").attr("data-fref");$("#movfnm").val(r);$("#movfnam").html("Move: "+r);$("#mov2nam").val(r);$("#fMovDlg").dialog("open")}break;case"mvto":if(p){sessionStorage.fmx_mvto=$("form[name='filst']").serialize()}else{if(!sessionStorage.fmx_mvto){alert("Nothing previously selected to move");break}e="act=mvto&todr="+encodeURIComponent(curDir)+"&"+sessionStorage.fmx_mvto;$.post("fmxjx.php",e,function(t,u,m){if(t){alert(t)}else{refreshFilst()}})}break;case"nfle":case"nfld":$("#ffact").val(n);$("#fNamDlg").dialog("option","title",n=="nfle"?"New File":"New Folder").dialog("open");break;case"refr":refreshFilst();break;case"rnam":if(l()){r=$(b[0]).parents("tr").attr("data-fref");$("#oldnm").val(r);$("#nunam").val(r);$("#fRenDlg").dialog("option","title","Rename <u>"+r+"</u>").dialog("open")}break;case"srhf":case"srhc":var h="file";var o=sessionStorage.fmx_strmf;if(n=="srhc"){h="content";o=sessionStorage.fmx_strmc}var j=prompt("Search for "+h+":",o);if(j){a=document.forms.cliterm;if(n=="srhf"){sessionStorage.fmx_strmf=j;a.cmdlin.value="find ./ -name "+j+" -ls"}else{sessionStorage.fmx_strmc=j;a.cmdlin.value="grep -R -I "+j+" *"}a.submit()}break;case"upld":if(doesSupportAjaxUploadWithProgress()){popUp("filupld5d.php?path="+curDir)}else{popUp("filupld.php?path="+curDir)}break;case"uzip":case"zip":case"tarz":case"utrz":if(l()){r=$(b[0]).parents("tr").attr("data-fref");a=document.forms.cliterm;if(n=="zip"){c=r.replace(/\s/g,"_");a.cmdlin.value="zip -r "+c+' "'+r+'"'}else{if(n=="uzip"){a.cmdlin.value='unzip "'+r+'"'}else{if(n=="tarz"){c=r.replace(/\s/g,"_");a.cmdlin.value="tar -czf "+c+'.tgz "'+r+'"'}else{if(n=="utrz"){a.cmdlin.value='tar -xzf "'+r+'"'}}}}a.submit()}break;case"webv":if(l()){r=$(b[0]).parents("tr").attr("data-fref");if(i.shiftKey){var s=prompt("URL:",r);if(s){r=s}else{break}}var d=curDir.slice(curDir.search("/"));pop(d+r,screen.availHeight,1200)}break;case"jxtr":if(l()){r=curDir+$(b[0]).parents("tr").attr("data-fref");var k=r.match(/([^\/\\]+)\.(\w+)$/);if(k&&k[2]=="xml"){e={act:"jxtr",fref:r,dir:curDir};$.post("fmxjx.php",e,function(t,u,m){if(t){alert(t)}})}else{alert("Must be an XML file")}}break;case"fmxi":e={act:"fmxi"};$.post("fmxjx.php",e,function(t,u,m){if(t){alert(t)}});break;case"cmcs":console.log(i);var q=document.createElement("div");q.id="util-view";var f=document.createElement("div");f.innerHTML="Loading ...";q.style.left=(i.clientX+20)+"px";q.style.top=(i.clientY-8)+"px";q.appendChild(f);document.body.appendChild(q);e={act:"CLIC"};$(q).load("fmxjx.php",e,function(t,u,m){$("#util-view div").click(function(v){v.preventDefault();doFillCLI($(this).attr("data-cmd"));document.body.removeChild(q)})});break;case"mnu":break;default:alert("?"+n+"?");break}}var editWindow;function doViewFile(a){var b="filwin.php?fref="+a;pop(b,600,800)}function doEditFile(b){var a="filedtwin.php?fref="+b;editWindow=pop(a,screen.availHeight,screen.availWidth)}function doFileAction(b,e,a){a.preventDefault();a.stopPropagation();var f=escape($(e).parents("tr").attr("data-fref"));var d=curDir+f;var c;switch(b){case"finf":c={act:b,fref:d};$.post("fmxjx.php",c,function(h,i,g){if(h){$("#aMsg").html(h);$("#aMsgDlg").dialog("option","title","File info for: "+f).dialog("open")}});break;case"fvue":doViewFile(d);break;case"fedt":doEditFile(d);break;default:alert("?"+b+"?");break}}function doFillCLI(a){$("#cmdlin").val(a)}function downloadFile(a,d,c){var b="fildnld.php?fle="+escape(a)+(d?"&tcdl=1&rad=Y":"")+(c?("&asf="+c):"");var e=document.createElement("iframe");e.src=b;e.style.display="none";document.body.appendChild(e)}function pop(d,e,b){var c=(screen.height-e)/2;var a=(screen.width-b)/2;var f="toolbar=no,status=no,location=no,menubar=no,resizable=0,scrollbars=1,width="+b+",height="+e+",left="+a+",top="+c;return open(d,"",f)}function popUp(a){var b=pop(a,240,416)}function allSelect(a,b){if(b.checked){$(".fsel").attr("checked",true)}else{$(".fsel").removeAttr("checked")}}function doesSupportAjaxUploadWithProgress(){function a(){var c=document.createElement("INPUT");c.type="file";return"files" in c}function b(){var c=new XMLHttpRequest();return !!(c&&("upload" in c)&&("onprogress" in c.upload))}return a()&&b()}function fils2up(){if(document.cliterm.cmdlin.value===""){alert("Please enter a command.");return false}else{var a=document.cliterm.cmdlin.value;if(a.indexOf("$$")>0){document.cliterm.cmdlin.value=a.replace("$$",makeFileList(sessionStorage.fmx_mrkd,false))}document.cliterm.submit();return true}}function makeFileList(a,e){var j=e?"<br />":" ";var f="";var h=a.split("\0");for(var g in h){var c=h[g].split("&");var d="";for(var b in c){var i=c[b].split("=");if(b==0){d="/"+i[1]}else{f+=d+"%2F"+i[1]+j}}}return f.replace(/%2F/g,"/")}function selectionAction(b){var c="";if(typeof window.getSelection!="undefined"){c=window.getSelection()}else{if(typeof document.selection!="undefined"){if(document.selection.type=="Text"){c=document.selection.createRange().text}}}var a=curDir+c;if(b){doEditFile(a)}else{doViewFile(a)}};