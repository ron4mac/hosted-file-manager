'use strict';function refreshFilst(){window.location=window.location.href.split("#")[0]}function refreshFilstO(a){var c=window.location.href.split("#")[0].split("?");window.location=c[1]?c[0]+"?"+c[1].split("&")[0]+"&O="+a:c[0]+"?O="+a}const toFormData=a=>{const c=new FormData;Object.keys(a).forEach(b=>{"object"!==typeof a[b]?c.append(b,a[b]):c.append(b,JSON.stringify(a[b]))});return c};
function postAction(a,c={},b=()=>{},e=!1){"object"===typeof c?c instanceof FormData||(c=toFormData(c)):"string"===typeof c&&(c=new URLSearchParams(c));a&&c.set("act",a);fetch(fmx_AJ,{method:"POST",body:c}).then(d=>{if(!d.ok)throw Error("Network response was not OK");return e?d.json():d.text()}).then(d=>b(d)).catch(d=>alert(d))}function postAndRefresh(a){postAction(null,a,c=>{c?alert(c):refreshFilst()})}
function postFormAndRefresh(a){let c=new FormData(document.forms.filst);c.set("act",a);postAndRefresh(c)}
var aMsgDlg={cselect:"#aMsgDlog",buttons:{"Okay`prm":function(){myCloseDlg(this)}}},aSchDlg={cselect:"#aSchDlog",buttons:{"Search`prm":function(){var a=document.myUIform;if(a.sterm.value.trim()){var c=a.sterm.value.trim(),b=document.forms.cliterm;"srhf"===a.cmd.value?(sessionStorage.fmx_strmf=c,b.cmdlin.value="find ./ -name "+c+" -ls"):(sessionStorage.fmx_strmc=c,b.cmdlin.value="grep -R -I "+c+" *");b.submit();myCloseDlg(this)}else alert("Please enter a valid search term")}}},fRenDlg={cselect:"#fRenDlog",
modal:!0,buttons:{"Rename`prm":function(){var a=document.myUIform;a.nunam.value.trim()?(a={act:"fren",fref:curDir+a.oldnm.value,nunm:curDir+a.nunam.value.trim()},myCloseDlg(this),postAndRefresh(a)):alert("Please enter a valid name")}}},fNamDlg={cselect:"#fNamDlog",buttons:{"Create`prm":function(){var a=document.myUIform;a.fref.value.trim()?(a={act:a.act.value,fref:curDir+a.fref.value.trim()},myCloseDlg(this),postAndRefresh(a)):alert("Please enter a valid name")}}},upldAction={H5w:()=>popUp(fmx_appPath+
"filupld5.php"),H5o:a=>$("#upload").jqm({ajax:fmx_appPath+"filupld5.php?o=1",ajaxText:"Loading...",onLoad:a,onHide:refreshFilst,target:".upldr",overlay:5}).jqmShow(),L4w:()=>popUp(fmx_appPath+"filupld.php"),L4o:()=>$("#upload").jqm({ajax:fmx_appPath+"filupld.php?o=1",ajaxText:"Loading...",onHide:refreshFilst,target:".upldr",overlay:5}).jqmShow()};
function downloadFile(a,c,b){a=fmx_appPath+"fildnld.php?fle="+encodeURI(a)+(c?"&tcdl=1&rad=Y":"")+(b?"&asf="+b:"");c=document.createElement("iframe");c.src=a;c.style.display="none";document.body.appendChild(c)}function makeFileList(a,c){c=c?"<br />":" ";var b="",e;a=a.split("\x00");var d,g=encodeURIComponent(curDir).length;for(e in a){var f=a[e].split("&");var k="";for(d in f){var h=f[d].split("=");0===1*d?k=h[1].substr(g):b+=k+"%2F"+h[1]+c}}return b.replace(/%2F/g,"/")}
function doesSupportAjaxUploadWithProgress(){var a;if(a="undefined"!==typeof window.FileList)a=new XMLHttpRequest,a=!!(a&&"upload"in a&&"onprogress"in a.upload);return a}function pop(a,c,b){b>screen.availWidth&&(b=screen.availWidth);return window.open(a,"","toolbar=no,status=no,location=no,menubar=no,resizable=0,scrollbars=1,width="+b+",height="+c+",left="+(screen.width-b)/2+",top="+(screen.height-c)/2)}
function popPost(a,c,b,e,d){d>screen.availWidth&&(d=screen.availWidth);var g="",f;for(f in c)g+='<input type="hidden" name="'+f+'" value="'+c[f]+'" />';a=$('<form action="'+a+'" method="post" target="'+b+'">'+g+"</form>");$(document.body).append(a);window.open("",b,"toolbar=no,status=no,location=no,menubar=no,resizable=0,scrollbars=1,width="+d+",height="+e+",left="+(screen.width-d)/2+",top="+(screen.height-e)/2).focus();a[0].submit()}function popUp(a){pop(a,240,416)}
function doMenuAction(a,c){var b=$(".fsel:checked"),e=b.length;var d=()=>{if(e)if(1<e)alert("Please select only one item.");else return!0;else alert("An item needs to be selected");return!1};var g=()=>{if(e)return!0;alert("Some items need to be selected");return!1};switch(a){case "cppa":e?(sessionStorage.fmx_cppa=$('form[name="filst"]').serialize(),show_mcount("#cppaMenu",sessionStorage.fmx_cppa)):sessionStorage.fmx_cppa&&postAndRefresh("act=cppa&todr="+encodeURIComponent(curDir)+"&"+sessionStorage.fmx_cppa);
break;case "trsh":g()&&(1==e||confirm("You have multiple files selected. Are you sure you want to trash ALL the selected files?"))&&postFormAndRefresh("trsh");break;case "mpty":postAndRefresh("act=mpty");break;case "delf":g()&&(1==e||confirm("You have multiple files selected. Are you sure you want to delete ALL the selected files?"))&&postFormAndRefresh("delf");break;case "tvew":window.location="?dir=tmp/Trash";break;case "dnld":if(g()){$("div.dnldprg").css("display","inline");var f=new FormData(document.forms.filst);
f.set("act","dnld");postAction(null,f,h=>{$("div.dnldprg").css("display","none");h?downloadFile(h.fpth,"Y"==h.rad,!1):alert("download not available")},!0)}break;case "dupl":d()&&(f={act:"dupl",fref:curDir+$(b[0]).parents("tr").attr("data-fref")},postAndRefresh(f));break;case "mark":f=void 0===sessionStorage.fmx_mrkd?"":sessionStorage.fmx_mrkd+"\x00";e&&(sessionStorage.fmx_mrkd=f+$('form[name="filst"]').serialize(),bump_mcount("#markMenu",e));break;case "mmiz":d()&&(d=$(b[0]).parents("tr").attr("data-fref"),
$("#upload").jqm({ajax:fmx_appPath+"jsmini.php?f="+encodeURIComponent(d),ajaxText:"Loading...",target:".upldr",overlay:5}).jqmShow());break;case "mvto":e?(sessionStorage.fmx_mvto=$('form[name="filst"]').serialize(),show_mcount("#mvtoMenu",sessionStorage.fmx_mvto)):sessionStorage.fmx_mvto?(f=sessionStorage.fmx_mvto,sessionStorage.removeItem("fmx_mvto"),postAndRefresh("act=mvto&todr="+encodeURIComponent(curDir)+"&"+f)):alert("Nothing previously selected to move");break;case "nfle":case "nfld":myOpenDlg(c,
fNamDlg,{act:a},"nfle"==a?"New File":"New Folder");break;case "refr":refreshFilst();break;case "rnam":d()&&(d=$(b[0]).parents("tr").attr("data-fref"),myOpenDlg(c,fRenDlg,{old:d,"new":d}));break;case "srhf":case "srhc":d=sessionStorage.fmx_strmf;"srhc"==a&&(d=sessionStorage.fmx_strmc);myOpenDlg(c,aSchDlg,{cmd:a,trm:d});break;case "turl":d()&&$("#upload").jqm({ajax:fmx_appPath+"filcurlm.php?t=1",ajaxText:"Loading...",target:".upldr",overlay:5}).jqmShow();break;case "furl":$("#upload").jqm({ajax:fmx_appPath+
"filcurlm.php",ajaxText:"Loading...",target:".upldr",overlay:5}).jqmShow();break;case "mdya":pop(fmx_appPath+"media.php?sd=/"+sessionStorage.fmx_curD,screen.availHeight,1200);break;case "upld":doesSupportAjaxUploadWithProgress()?upload_winpop?upldAction.H5w():upldAction.H5o():upload_winpop?upldAction.L4w():upldAction.L4o();break;case "uzip":case "zip":case "tarz":case "utrz":if(d()){d=$(b[0]).parents("tr").attr("data-fref");g=document.forms.cliterm;if("zip"==a){if(a="zip ",$(b[0]).parent().next().hasClass("foldCtxt")&&
(a+="-r "),b=d.replace(/\s/g,"_"),g.cmdlin.value=a+b+'.zip "'+d+'"',c.shiftKey)if(d=prompt("COMMAND:",g.cmdlin.value+' -x "*/sv_*" -x "*/.git*"'))g.cmdlin.value=d;else break}else"uzip"==a?g.cmdlin.value='unzip "'+d+'"':"tarz"==a?(b=d.replace(/\s/g,"_"),g.cmdlin.value="tar -czf "+b+'.tgz "'+d+'"'):"utrz"==a&&(g.cmdlin.value='tar -xzf "'+d+'"');g.submit()}break;case "mgzp":d()&&(d=$(b[0]).parents("tr").attr("data-fref"),d=encodeURIComponent(curDir+d),doManageZip(d));break;case "webv":if(d()){d=$(b[0]).parents("tr").attr("data-fref");
if(c.shiftKey&&(d=prompt("URL:",d),!d))break;a=ctxPrf+curDir.slice(curDir.search("/"));pop(a+d,screen.availHeight,.6*screen.availWidth)}break;case "gitr":d()&&(".git"==$(b[0]).parents("tr").attr("data-fref")?(f="?dir="+curDir,pop(fmx_appPath+"gitter.php"+f,screen.availHeight,1200)):alert("Please select a '.git' folder"));break;case "jxtr":d()&&(d=curDir+$(b[0]).parents("tr").attr("data-fref"),(a=d.match(/([^\/\\]+)\.(\w+)$/))&&"xml"==a[2]?(f={act:"jxtr",fref:d,dir:curDir},postAction(null,f,h=>{h&&
alert(h)})):alert("Must be an XML file"));break;case "sql3":if(!e||d())f="?dir="+curDir,e&&(f="?dbf="+curDir+$(b[0]).parents("tr").attr("data-fref")),pop(fmx_appPath+"pla/phpliteadmin.php"+f,screen.availHeight,.8*screen.availWidth);break;case "fmxi":f={act:"fmxi"};postAction("fmxi",{},h=>{if(h.updt){var m=h.updt.split("|");var l=$.extend(!0,{},aMsgDlg,{buttons:{"Update now":()=>{confirm("It is a good idea to backup first. Do you want to continue with the update?")&&(f={act:"updt",nver:m[1]},postAndRefresh(f),
myCloseDlg(this))}}})}else l=aMsgDlg;myOpenDlg(c,l,{msg:h.msg},"FMX - Hosted File Manager")},!0);break;case "cmcs":var k=document.createElement("div");k.id="util-view";d=document.createElement("div");d.innerHTML="Loading ...";k.style.left=c.clientX-60+"px";k.style.top=c.clientY-48+"px";k.appendChild(d);document.body.appendChild(k);f={act:"CLIC"};$(k).load(fmx_AJ,f,()=>{k.style.top=c.clientY-k.clientHeight-20+"px";$("#util-view div").click(h=>{h.preventDefault();doFillCLI($(this).attr("data-cmd"));
document.body.removeChild(k)})});break;case "mnu":break;default:alert("?"+a+"?")}}var editWindow;function doViewFile(a){pop(fmx_appPath+"filwin.php?fref="+a,675,900)}function doEditFile(a,c){editWindow=c?window.open(fmx_appPath+"filedwin.php?t=1&fref="+a,"_blank"):pop(fmx_appPath+"filedwin.php?fref="+a,screen.availHeight,screen.availWidth)}function doEditImage(a){popPost(fmx_appPath+"imgedtwin.php",{fref:a},"imgedt",screen.availHeight,Math.min(1200,screen.availWidth))}
function doManageZip(a){editWindow=pop(fmx_appPath+"arcview.php?fref="+a,.75*screen.availHeight,.5*screen.availWidth)}
function doFileAction(a,c,b){b&&(b.preventDefault(),b.stopPropagation());var e=$(c).parents("tr").attr("data-fref");c=encodeURIComponent(curDir+e);switch(a){case "finf":a={act:a,fref:c};postAction(null,a,d=>myOpenDlg(b,aMsgDlg,{msg:d},"File info for: "+e));break;case "fvue":doViewFile(c);break;case "fedt":doEditFile(c,b?b.altKey:!1);break;case "iedt":doEditImage(c);break;default:alert("?"+a+"?")}}function doFillCLI(a){$("#cmdlin").val(a)}
function allSelect(a,c){c.checked?$(".fsel").prop("checked",!0):$(".fsel").prop("checked",!1)}function fils2up(){if(""===document.cliterm.cmdlin.value)return alert("Please enter a command."),!1;var a=document.cliterm.cmdlin.value;0<a.indexOf("$$")&&(document.cliterm.cmdlin.value=a.replace("$$",makeFileList(sessionStorage.fmx_mrkd,!1)));document.cliterm.submit();return!0}
function selectionAction(a){var c="";"undefined"!==window.getSelection?c=window.getSelection():"undefined"!==document.selection&&"Text"==document.selection.type&&(c=document.selection.createRange().text);c=curDir+c;a?doEditFile(c):doViewFile(c)}function display_cmmStorage(a){if(a){var c="";a=a.split("\x00");for(var b in a)for(var e=decodeURIComponent(a[b]).split("&"),d=0;d<e.length;d++)0<d&&(c+="    "),c+=e[d]+"\n";alert(c)}else alert("[ empty ]")}
function show_mcount(a,c){var b=$(a).html().split("(");if(c){c=c.split("\x00");var e=0,d;for(d in c)for(var g=decodeURIComponent(c[d]).split("&"),f=0;f<g.length;f++)f&&e++;$(a).html(b[0]+"("+e+")")}else $(a).html(b[0])}function bump_mcount(a,c){var b=$(a).html(),e=b.split("(");0>c?$(a).html(e[0]):e[1]?(b=e[1],b=b.substr(0,b.length-1),$(a).html(e[0]+"("+(+b+c)+")")):$(a).html(b+"("+c+")")}
function cm_del(a,c){a=$(a).parents("tr").attr("data-fref");confirm("Are you sure you want to delete this "+(c?"folder and contents":"file")+": "+a+" ?")&&postAndRefresh({act:"delf",dir:curDir,"files[]":a})}function cm_dld(a,c){a={act:"dnld",dir:curDir,"files[]":$(a).parents("tr").attr("data-fref")+(c?"/":"")};postAction(null,a,b=>{b?downloadFile(b.fpth,"Y"==b.rad,!1):alert("download not available")},!0)}
function cm_dup(a){a={act:"dupl",fref:curDir+$(a).parents("tr").attr("data-fref")};postAndRefresh(a)}function cm_ren(a){a=$(a).parents("tr").attr("data-fref");myOpenDlg(null,fRenDlg,{old:a,"new":a})}function cm_zip(a,c){a=$(a).parents("tr").attr("data-fref");var b=document.forms.cliterm,e="zip ";c&&(e+="-r ");c=a.replace(/\s/g,"_");b.cmdlin.value=e+c+'.zip "'+a+'"';b.submit()}
function cm_slnk(){if(sessionStorage.fmx_mrkd){var a=sessionStorage.fmx_mrkd.split("\x00");if(1!=a.length)alert("Can SymLink to only one location at a time");else{var c=a[0].split("&"),b=c[0].split("=");a=b[1].replace(/%2F/g,"/");b=c[1].split("=");c=b[1].replace(/%2F/g,"/");b=prompt("Link to marked:","");null!==b&&postAndRefresh({act:"slnk",fref:a+"/"+c,tref:curDir,alnk:b})}}else alert("Mark something to link first")}
$(()=>{try{sessionStorage.fmx_ok=1}catch(b){alert("Your browser 'sessionStorage' is not functioning. (private browsing?) Not all functions of FMX will work successfully.")}sessionStorage.fmx_curD=curDir;$("#fmnu [data-mnu]").click(function(b){b.preventDefault();doMenuAction($(this).attr("data-mnu"),b)});$("#footerPopContent [data-mnu]").click(function(b){b.preventDefault();doMenuAction($(this).attr("data-mnu"),b)});$("#ftbl [data-act]").click(function(b){b.preventDefault();doFileAction($(this).attr("data-act"),
this,b)});$("nav li ul").hide().removeClass("fallback");$("nav li").hover(function(){$("ul",this).stop(!0,!0).fadeToggle(100)});let a=$(".fsel"),c=null;a.click(function(b){if(c){if(b.shiftKey){b=a.index(this);let e=a.index(c);a.slice(Math.min(b,e),Math.max(b,e)+1).prop("checked",c.checked)}c=this;if(this.checked){let e=0;$(".fsel").each(function(){this.checked||(e=1)});0===e&&$("#checkAll").prop("checked",!0)}else $("#checkAll").prop("checked",!1)}else c=this});show_mcount("#cppaMenu",sessionStorage.fmx_cppa);
show_mcount("#markMenu",sessionStorage.fmx_mrkd);show_mcount("#mvtoMenu",sessionStorage.fmx_mvto);$("a.cppaMenu").contextMenu("clrdMenu",{bindings:{clrdClr:()=>{sessionStorage.removeItem("fmx_cppa");bump_mcount("#cppaMenu",-1)},clrdDsp:()=>display_cmmStorage(sessionStorage.fmx_cppa)}});$("a.delfMenu").contextMenu("delfMenu",{bindings:{delfTrue:()=>doMenuAction("delf",null),delfMpty:()=>doMenuAction("mpty",null),delfView:()=>doMenuAction("tvew",null)}});$("a.markMenu").contextMenu("clrdMenuSL",{bindings:{clrdClr:()=>
{sessionStorage.removeItem("fmx_mrkd");bump_mcount("#markMenu",-1)},clrdDsp:()=>display_cmmStorage(sessionStorage.fmx_mrkd),symLnk:()=>cm_slnk()}});$("a.mvtoMenu").contextMenu("clrdMenu",{bindings:{clrdClr:()=>{sessionStorage.removeItem("fmx_mvto");bump_mcount("#mvtoMenu",-1)},clrdDsp:()=>display_cmmStorage(sessionStorage.fmx_mvto)}});$("a.upldMenu").contextMenu("upldMenu",{onContextMenu:()=>!0,bindings:{H5w:()=>upldAction.H5w(),H5o:()=>upldAction.H5o(),L4w:()=>upldAction.L4w(),L4o:()=>upldAction.L4o()}});
$("td.fileCtxt").contextMenu("fileCtxt",{bindings:{cfi_edt:b=>doFileAction("fedt",b,null),cfi_del:b=>cm_del(b,!1),cfi_dld:b=>cm_dld(b,!1),cfi_dup:b=>cm_dup(b,!1),cfi_ren:b=>cm_ren(b),cfi_zip:b=>cm_zip(b,!1)}});$("td.foldCtxt").contextMenu("foldCtxt",{bindings:{cfo_del:b=>cm_del(b,!0),cfo_dld:b=>cm_dld(b,!0),cfo_dup:b=>cm_dup(b,!0),cfo_ren:b=>cm_ren(b),cfo_zip:b=>cm_zip(b,!0)}});new FileDropper(document.getElementById("filsform"),b=>upldAction.H5o(()=>fupQadd2(b)))});
class FileDropper{constructor(a,c){a.addEventListener("dragover",this,!1);a.addEventListener("drop",this,!1);a.addEventListener("dragenter",this,!1);a.addEventListener("dragleave",this,!1);this.cb=c}handleEvent(a){a.preventDefault();switch(a.type){case "drop":this.cb(a.dataTransfer.files);break;case "dragenter":a.target.classList.add("upld-body");break;case "dragleave":a.target.classList.remove("upld-body")}}};